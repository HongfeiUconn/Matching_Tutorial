<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="OPIM 5510 - Web Analytics, Instructor: Xinxin Li" />


<title>A Tutorial to Matching</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">A Tutorial to Matching</h1>
<h4 class="author">OPIM 5510 - Web Analytics, Instructor: <a href="https://www.business.uconn.edu/person/xinxin-li/">Xinxin Li</a></h4>
<h4 class="date">Last Updated: February 13, 2020</h4>



<p>This tutorial uses an empirical example to describe matching strategies. The data source is used in a working paper written by:</p>
<p><a href="https://www.hongfei-business.com/">Hongfei Li</a> <a href="https://www.business.uconn.edu/person/jing-peng/">Jing Peng</a> <a href="https://www.business.uconn.edu/person/xinxin-li/">Xinxin Li</a> <a href="https://www.business.uconn.edu/person/jan-stallaert/">Jan Stallaert</a></p>
<p>All the data source and R codes can be found <a href="https://github.com/HongfeiUconn/Matching_Tutorial">here</a>.</p>
<div id="import-libraries" class="section level2">
<h2>Import libraries</h2>
<ul>
<li>All data filter and rearrangement are based on package <a href="https://cran.r-project.org/web/packages/data.table/data.table.pdf">data.table</a>.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(cem)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co">#&gt; Loading required package: tcltk</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">#&gt; Loading required package: lattice</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; How to use CEM? Type vignette(&quot;cem&quot;)</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">library</span>(data.table)</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">library</span>(MatchIt)</a></code></pre></div>
</div>
<div id="empirical-context" class="section level2">
<h2>Empirical Context</h2>
<p>Our context is one of the largest online platforms for cosmetic procedures in China. It allows customers to make appointments for a cosmetic procedure offered by a specific hospital online by paying a certain amount of deposit. Then the customer goes offline to pay the rest of the price and take the surgery.</p>
<p>The platform offers a complication insurance policy, which aims at compensating customers for surgical malpractice or post-treatment complications such as severe infection. However, this insurance policy is only available for a subset of procedures. We are interested in whether the insurance has any effect on the average sales of procedures.</p>
</div>
<div id="explore-data" class="section level2">
<h2>Explore Data</h2>
<div id="read-data" class="section level3">
<h3>Read Data</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">data =<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data.csv&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">colnames</span>(data)</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">#&gt;  [1] &quot;ProcedureID&quot;   &quot;ProcedureAge&quot;  &quot;AvgCompNum&quot;    &quot;AvgReviews&quot;   </span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">#&gt;  [5] &quot;PriceDeposit&quot;  &quot;PricePaid&quot;     &quot;PriceOrigin&quot;   &quot;Public&quot;       </span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">#&gt;  [9] &quot;SurgeonNum&quot;    &quot;ReviewBonus&quot;   &quot;Ad&quot;            &quot;Financing&quot;    </span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">#&gt; [13] &quot;GroupPurchase&quot; &quot;Insurance&quot;     &quot;AvgSales&quot;</span></a></code></pre></div>
</div>
<div id="description-of-variables" class="section level3">
<h3>Description of Variables</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co">## Read data fastly</span></a>
<a class="sourceLine" id="cb3-2" title="2">description =<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;description.csv&quot;</span>)</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">## Description of Variables </span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="kw">library</span>(knitr)</a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">kable</span>(description, <span class="dt">caption =</span> <span class="st">&quot;Description of Variables&quot;</span>)</a></code></pre></div>
<table>
<caption>Description of Variables</caption>
<thead>
<tr class="header">
<th align="left">Variables</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ProcedureAge</td>
<td align="left">The number of months since a procedure was first available when the complication insurance was introduced</td>
</tr>
<tr class="even">
<td align="left">AvgCompNum</td>
<td align="left">Average monthly number of competitors</td>
</tr>
<tr class="odd">
<td align="left">AvgReviews</td>
<td align="left">Average monthly number of reviews</td>
</tr>
<tr class="even">
<td align="left">PriceDeposit</td>
<td align="left">The amount of deposit for the procedure</td>
</tr>
<tr class="odd">
<td align="left">PricePaid</td>
<td align="left">The effective price for the procedure, net of discounts</td>
</tr>
<tr class="even">
<td align="left">PriceOrigin</td>
<td align="left">The original price of the procedure</td>
</tr>
<tr class="odd">
<td align="left">SurgeonNum</td>
<td align="left">The number of surgeons available for the procedure</td>
</tr>
<tr class="even">
<td align="left">Public</td>
<td align="left">Dummy. Whether this procedure is performed by a public hospital</td>
</tr>
<tr class="odd">
<td align="left">ReviewBonus</td>
<td align="left">Dummy. Whether the provider offers a bonus for users to write reviews</td>
</tr>
<tr class="even">
<td align="left">Ad</td>
<td align="left">Dummy. Whether there is an ad on the webpage of this procedure</td>
</tr>
<tr class="odd">
<td align="left">Financing</td>
<td align="left">Dummy. Whether this procedure supports financing</td>
</tr>
<tr class="even">
<td align="left">GroupPurchase</td>
<td align="left">Dummy. Whether this procedure supports group purchasing</td>
</tr>
</tbody>
</table>
<p>Here, AvgSales is the dependent (or outcome) variable and Insurance is the treatment variable. When Insurance equals to 0, it means this procedure is not offered the complication insurance option, 1 otherwise.</p>
</div>
<div id="motivation" class="section level3">
<h3>Motivation</h3>
<p>To answer the above question, one can first come up with simple linear regression.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co">## Simple linear regression</span></a>
<a class="sourceLine" id="cb4-2" title="2">slr_no_match =<span class="st"> </span><span class="kw">lm</span>(AvgSales<span class="op">~</span>Insurance, <span class="dt">data =</span> data) </a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">## Output the regression results</span></a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="kw">kable</span>(<span class="kw">summary</span>(slr_no_match)<span class="op">$</span>coefficients, <span class="dt">caption =</span> <span class="st">&quot;Simple Linear Regression without Matching&quot;</span>)</a></code></pre></div>
<table>
<caption>Simple Linear Regression without Matching</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Estimate</th>
<th align="right">Std. Error</th>
<th align="right">t value</th>
<th align="right">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td align="right">1.745647</td>
<td align="right">0.2499938</td>
<td align="right">6.982761</td>
<td align="right">0e+00</td>
</tr>
<tr class="even">
<td>Insurance</td>
<td align="right">1.796752</td>
<td align="right">0.3600070</td>
<td align="right">4.990881</td>
<td align="right">7e-07</td>
</tr>
</tbody>
</table>
<p>From the above results, the effect of insurance is significantly positive. Next, we use multiple linear regression, which is more robust than simple linear regression.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co">## Multiple linear regression</span></a>
<a class="sourceLine" id="cb5-2" title="2">mlr_no_match =<span class="st"> </span><span class="kw">lm</span>(AvgSales<span class="op">~</span>Insurance <span class="op">+</span><span class="st"> </span>ProcedureAge <span class="op">+</span><span class="st"> </span>AvgCompNum <span class="op">+</span><span class="st"> </span>AvgReviews <span class="op">+</span><span class="st"> </span>PriceDeposit <span class="op">+</span><span class="st"> </span>PricePaid <span class="op">+</span><span class="st"> </span>PriceOrigin <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>SurgeonNum <span class="op">+</span><span class="st"> </span>ReviewBonus <span class="op">+</span><span class="st"> </span>Ad <span class="op">+</span><span class="st"> </span>Financing <span class="op">+</span><span class="st"> </span>GroupPurchase, <span class="dt">data =</span> data) </a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">## Output the regression results</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="kw">kable</span>(<span class="kw">summary</span>(mlr_no_match)<span class="op">$</span>coefficients, <span class="dt">caption =</span> <span class="st">&quot;Multiple Linear Regression without Matching&quot;</span>)</a></code></pre></div>
<table>
<caption>Multiple Linear Regression without Matching</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Estimate</th>
<th align="right">Std. Error</th>
<th align="right">t value</th>
<th align="right">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td align="right">-0.3290385</td>
<td align="right">0.5731808</td>
<td align="right">-0.5740570</td>
<td align="right">0.5660280</td>
</tr>
<tr class="even">
<td>Insurance</td>
<td align="right">0.5401356</td>
<td align="right">0.3676441</td>
<td align="right">1.4691806</td>
<td align="right">0.1420245</td>
</tr>
<tr class="odd">
<td>ProcedureAge</td>
<td align="right">-0.0382136</td>
<td align="right">0.0346189</td>
<td align="right">-1.1038372</td>
<td align="right">0.2698670</td>
</tr>
<tr class="even">
<td>AvgCompNum</td>
<td align="right">0.2527672</td>
<td align="right">0.0433001</td>
<td align="right">5.8375623</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td>AvgReviews</td>
<td align="right">2.7419115</td>
<td align="right">0.2252522</td>
<td align="right">12.1726267</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td>PriceDeposit</td>
<td align="right">-0.0006512</td>
<td align="right">0.0002178</td>
<td align="right">-2.9898632</td>
<td align="right">0.0028432</td>
</tr>
<tr class="odd">
<td>PricePaid</td>
<td align="right">0.0000083</td>
<td align="right">0.0000330</td>
<td align="right">0.2513723</td>
<td align="right">0.8015658</td>
</tr>
<tr class="even">
<td>PriceOrigin</td>
<td align="right">0.0000074</td>
<td align="right">0.0000187</td>
<td align="right">0.3970773</td>
<td align="right">0.6913753</td>
</tr>
<tr class="odd">
<td>Public</td>
<td align="right">0.0234518</td>
<td align="right">0.7856962</td>
<td align="right">0.0298485</td>
<td align="right">0.9761924</td>
</tr>
<tr class="even">
<td>SurgeonNum</td>
<td align="right">0.2500097</td>
<td align="right">0.3052465</td>
<td align="right">0.8190420</td>
<td align="right">0.4129117</td>
</tr>
<tr class="odd">
<td>ReviewBonus</td>
<td align="right">-0.6196929</td>
<td align="right">3.4904615</td>
<td align="right">-0.1775390</td>
<td align="right">0.8591126</td>
</tr>
<tr class="even">
<td>Ad</td>
<td align="right">0.8923829</td>
<td align="right">0.6151730</td>
<td align="right">1.4506210</td>
<td align="right">0.1471254</td>
</tr>
<tr class="odd">
<td>Financing</td>
<td align="right">1.2505170</td>
<td align="right">0.4258077</td>
<td align="right">2.9368118</td>
<td align="right">0.0033741</td>
</tr>
<tr class="even">
<td>GroupPurchase</td>
<td align="right">1.3012623</td>
<td align="right">0.5307413</td>
<td align="right">2.4517826</td>
<td align="right">0.0143452</td>
</tr>
<tr class="odd">
<td>From the above r</td>
<td align="right">esults, the e</td>
<td align="right">ffect of insu</td>
<td align="right">rance is not</td>
<td align="right">significant anymore after controlling for all the covariates.</td>
</tr>
</tbody>
</table>
</div>
<div id="why-do-we-want-to-use-matching" class="section level3">
<h3>Why do we want to use matching?</h3>
<p>Suppose in an ideal situation, one procedure is insured and uninsured at the same time, then if we take the difference of the average monthly sales under the insured and uninsured situations, we can get a precise measurement of the impact of the insurance policy. However, one procedure can either be insured or uninsured, but it can never be in these two situations simultaneously, unless we have a parallel universe (which is called “counterfactual” in the literature of causal inference). To solve this issue, we may have the following two options:</p>
<ul>
<li><p>For each insured procedure, find an uninsured procedure which is exactly same with this insured procedure in terms of all characteristics such as the procedure type, price, hospital, number of reviews, etc. In this situation, although the two procedures are “two” procedures, they can still be treated as the same one since there are no difference between them except for whether they are insured, just like a comparison between twins. It can be shown that the bias of the estimation of the effect of insurance is designed to be 0 in this situation. Coarsened exact matching (CEM) refers to this idea.</p></li>
<li><p>For each insured procedure, suppose the probability of this procedure is chosen to the insured group is <span class="math inline">\(p\)</span>, we need find an uninsured procedure whose probability of this procedure is chosen to the insured group is also <span class="math inline">\(p\)</span>. For example, flipping a fair coin to randomly assign the procedures into the insured or uninsured group. This means each procedure is equally likely to be assigned the insurance policy with probability 0.5. You can also use random number or toll a die to assign the procedures into the insured and uninsured groups, as long as you can guarantee a pair of procedures have the same chance to be assigned with the insurance. But in real world, we cannot assign the insurance by ourselves because everything has already been determined by the company. The only data we can use is observational but not experimental. However, if we happen to find two procedures—one insured and the other one uninsured—with the same probability to be assigned the insurance, we can solve the problem! This is the basic idea of propensity score matching. Then comparing the difference between their average monthly sales is an unbiased estimator of the effect of the insurance policy. It can be shown that the expectation of the bias of the estimation of the effect of insurance is 0. When the sample size is large enough, the bias becomes very close to 0 by law of large number.</p></li>
</ul>
</div>
</div>
<div id="propensity-score-matching" class="section level2">
<h2>Propensity Score Matching</h2>
<div id="compare-the-mean" class="section level3">
<h3>Compare the Mean</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co">### Create blank data table</span></a>
<a class="sourceLine" id="cb6-2" title="2">ttest_table_before_match =<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">varname =</span><span class="kw">character</span>(), <span class="dt">t.value=</span><span class="kw">numeric</span>(),</a>
<a class="sourceLine" id="cb6-3" title="3">                         <span class="dt">p.value =</span> <span class="kw">numeric</span>(), <span class="dt">mean_no_insurance =</span> <span class="kw">numeric</span>(),</a>
<a class="sourceLine" id="cb6-4" title="4">                         <span class="dt">mean_with_insurance =</span> <span class="kw">numeric</span>(), <span class="dt">diff =</span> <span class="kw">numeric</span>())</a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">### T-test for all variables</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="cf">for</span> (col <span class="cf">in</span> <span class="kw">colnames</span>(data)) {</a>
<a class="sourceLine" id="cb6-7" title="7">  <span class="cf">if</span> (col <span class="op">==</span><span class="st"> &quot;Insurance&quot;</span> <span class="op">|</span><span class="st"> </span>col <span class="op">==</span><span class="st"> &quot;ProcedureID&quot;</span>) <span class="cf">next</span></a>
<a class="sourceLine" id="cb6-8" title="8">  zz =<span class="st"> </span><span class="kw">t.test</span>(<span class="kw">get</span>(col)<span class="op">~</span><span class="kw">get</span>(<span class="st">&quot;Insurance&quot;</span>),<span class="dt">data =</span> data)</a>
<a class="sourceLine" id="cb6-9" title="9">  tvalue =<span class="st"> </span>zz<span class="op">$</span>statistic[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb6-10" title="10">  pvalue =<span class="st"> </span>zz<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb6-11" title="11">  mean1 =<span class="st"> </span>zz<span class="op">$</span>estimate[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb6-12" title="12">  mean2 =<span class="st"> </span>zz<span class="op">$</span>estimate[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb6-13" title="13">  temp =<span class="st"> </span>ttest_table_before_match[,<span class="kw">list</span>(<span class="dt">varname =</span> col, <span class="dt">t.value =</span> tvalue,</a>
<a class="sourceLine" id="cb6-14" title="14">                           <span class="dt">p.value =</span> pvalue, <span class="dt">mean_no_insurance =</span> mean1,</a>
<a class="sourceLine" id="cb6-15" title="15">                           <span class="dt">mean_with_insurance =</span> mean2,</a>
<a class="sourceLine" id="cb6-16" title="16">                           <span class="dt">diff =</span> mean1 <span class="op">-</span><span class="st"> </span>mean2)]</a>
<a class="sourceLine" id="cb6-17" title="17">  ttest_table_before_match =<span class="st"> </span><span class="kw">rbind</span>(temp,ttest_table_before_match)</a>
<a class="sourceLine" id="cb6-18" title="18">}</a>
<a class="sourceLine" id="cb6-19" title="19"></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="kw">kable</span>(ttest_table_before_match, <span class="dt">caption =</span> <span class="st">&quot;Compare the Mean of All Variables of Insured and Uninsured Procedures before Matching&quot;</span>)</a></code></pre></div>
<table>
<caption>Compare the Mean of All Variables of Insured and Uninsured Procedures before Matching</caption>
<thead>
<tr class="header">
<th align="left">varname</th>
<th align="right">t.value</th>
<th align="right">p.value</th>
<th align="right">mean_no_insurance</th>
<th align="right">mean_with_insurance</th>
<th align="right">diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">AvgSales</td>
<td align="right">-4.8758000</td>
<td align="right">0.0000013</td>
<td align="right">1.745647e+00</td>
<td align="right">3.5423991</td>
<td align="right">-1.7967519</td>
</tr>
<tr class="even">
<td align="left">GroupPurchase</td>
<td align="right">-2.6980109</td>
<td align="right">0.0070700</td>
<td align="right">9.210530e-02</td>
<td align="right">0.1397174</td>
<td align="right">-0.0476122</td>
</tr>
<tr class="odd">
<td align="left">Financing</td>
<td align="right">-3.9780773</td>
<td align="right">0.0000733</td>
<td align="right">6.856725e-01</td>
<td align="right">0.7817896</td>
<td align="right">-0.0961171</td>
</tr>
<tr class="even">
<td align="left">Ad</td>
<td align="right">-4.5169625</td>
<td align="right">0.0000069</td>
<td align="right">5.116960e-02</td>
<td align="right">0.1208791</td>
<td align="right">-0.0697095</td>
</tr>
<tr class="odd">
<td align="left">ReviewBonus</td>
<td align="right">0.5218571</td>
<td align="right">0.6018622</td>
<td align="right">2.924000e-03</td>
<td align="right">0.0015699</td>
<td align="right">0.0013541</td>
</tr>
<tr class="even">
<td align="left">SurgeonNum</td>
<td align="right">-9.3835064</td>
<td align="right">0.0000000</td>
<td align="right">9.722222e-01</td>
<td align="right">1.2558870</td>
<td align="right">-0.2836647</td>
</tr>
<tr class="odd">
<td align="left">Public</td>
<td align="right">-2.0704850</td>
<td align="right">0.0386169</td>
<td align="right">4.532160e-02</td>
<td align="right">0.0722135</td>
<td align="right">-0.0268919</td>
</tr>
<tr class="even">
<td align="left">PriceOrigin</td>
<td align="right">3.9876031</td>
<td align="right">0.0000705</td>
<td align="right">1.378258e+04</td>
<td align="right">9475.7959184</td>
<td align="right">4306.7888770</td>
</tr>
<tr class="odd">
<td align="left">PricePaid</td>
<td align="right">3.6664072</td>
<td align="right">0.0002562</td>
<td align="right">6.815352e+03</td>
<td align="right">4395.2276295</td>
<td align="right">2420.1247097</td>
</tr>
<tr class="even">
<td align="left">PriceDeposit</td>
<td align="right">2.6663212</td>
<td align="right">0.0077632</td>
<td align="right">9.464415e+02</td>
<td align="right">738.4175824</td>
<td align="right">208.0239381</td>
</tr>
<tr class="odd">
<td align="left">AvgReviews</td>
<td align="right">-1.5871114</td>
<td align="right">0.1127395</td>
<td align="right">3.936005e-01</td>
<td align="right">0.4587423</td>
<td align="right">-0.0651417</td>
</tr>
<tr class="even">
<td align="left">AvgCompNum</td>
<td align="right">-12.6088569</td>
<td align="right">0.0000000</td>
<td align="right">1.774866e+00</td>
<td align="right">4.5413598</td>
<td align="right">-2.7664936</td>
</tr>
<tr class="odd">
<td align="left">ProcedureAge</td>
<td align="right">-2.0790160</td>
<td align="right">0.0378100</td>
<td align="right">6.834795e+00</td>
<td align="right">7.3940345</td>
<td align="right">-0.5592392</td>
</tr>
</tbody>
</table>
<p>Notice, the p-value of most variables are smaller than .05, which means the characteristics of insured and uninsured procedures are mostly different. Next, let’s use <a href="https://cran.r-project.org/web/packages/MatchIt/MatchIt.pdf">MatchIt</a> package to perform propensity score matching. More details about this package please refer to the <a href="https://imai.fas.harvard.edu/research/files/matchit.pdf">JSS paper</a>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">psm =<span class="st"> </span><span class="kw">matchit</span>(Insurance <span class="op">~</span><span class="st">  </span>ProcedureAge <span class="op">+</span><span class="st"> </span>AvgCompNum <span class="op">+</span><span class="st"> </span>AvgReviews <span class="op">+</span><span class="st"> </span>PriceDeposit  <span class="op">+</span><span class="st"> </span>PricePaid <span class="op">+</span><span class="st"> </span>PriceOrigin <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>SurgeonNum <span class="op">+</span><span class="st"> </span>ReviewBonus <span class="op">+</span><span class="st"> </span>Ad <span class="op">+</span><span class="st"> </span>Financing <span class="op">+</span><span class="st"> </span>GroupPurchase ,</a>
<a class="sourceLine" id="cb7-2" title="2">              <span class="dt">data =</span> data, <span class="dt">method =</span> <span class="st">&quot;nearest&quot;</span>,</a>
<a class="sourceLine" id="cb7-3" title="3">              <span class="dt">ratio =</span> <span class="dv">1</span>, <span class="dt">distance =</span> <span class="st">&#39;logit&#39;</span>, <span class="dt">caliper =</span> <span class="fl">.05</span>)</a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">## distance: This argument specifies the method used to estimate the distance measure. The default is logistic regression, &quot;logit&quot;. A variety of other methods are available.</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">## nearest: This means the matching method we use for PSM is nearest neighbor.</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">## ratio: the number of control units to match to each treated unit (default = 1).</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">## caliper: the number of standard deviations of the distance measure within which to draw control units (default = 0, no caliper matching). If a caliper is specified, a control unit within the caliper for a treated unit is randomly selected as the match for that treated unit. I</span></a></code></pre></div>
<p>The above command will generate a list of results. If we want to see the matching results, we can use:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">psm_result =<span class="st"> </span><span class="kw">summary</span>(psm)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">## The following shows the matching results.</span></a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="kw">kable</span>(<span class="kw">as.table</span>(psm_result<span class="op">$</span>nn), <span class="dt">caption =</span> <span class="st">&quot;Matching Results&quot;</span>)</a></code></pre></div>
<table>
<caption>Matching Results</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Control</th>
<th align="right">Treated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>All</td>
<td align="right">684</td>
<td align="right">637</td>
</tr>
<tr class="even">
<td>Matched</td>
<td align="right">438</td>
<td align="right">438</td>
</tr>
<tr class="odd">
<td>Unmatched</td>
<td align="right">246</td>
<td align="right">199</td>
</tr>
<tr class="even">
<td>Discarded</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The above table means: 438 procedures out of uninsured procedures are matched with 438 procedures out of insured procedures. Since we used one-to-one matching, the numbers of matched insured and uninsured procedures are the same. For the unmatched procedures, we can directly remove them. Then we can use the rest of sample for further analysis.</p>
<p>Here, we mainly focus on “weights”, which is a dummy variable and means whether the procedure has been selected during the matching process. If a procedure’s weight is 0, it means this procedure is in unmatched group.</p>
<p>To get the data after matching, we can run the following commands:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co">## First combine weights to the original data set</span></a>
<a class="sourceLine" id="cb9-2" title="2">data_psm =<span class="st"> </span><span class="kw">cbind</span>(data, <span class="dt">weights =</span> psm<span class="op">$</span>weights)</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="co">## Next, let&#39;s remove all procedures that are removed by matching process</span></a>
<a class="sourceLine" id="cb9-4" title="4">data_psm =<span class="st"> </span>data_psm[<span class="op">!</span>(weights <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)]</a></code></pre></div>
</div>
<div id="compare-the-mean-after-matching" class="section level3">
<h3>Compare the Mean after Matching</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co">### Create blank data table</span></a>
<a class="sourceLine" id="cb10-2" title="2">ttest_table_after_match =<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">varname =</span><span class="kw">character</span>(), <span class="dt">t.value=</span><span class="kw">numeric</span>(),</a>
<a class="sourceLine" id="cb10-3" title="3">                         <span class="dt">p.value =</span> <span class="kw">numeric</span>(), <span class="dt">mean_no_insurance =</span> <span class="kw">numeric</span>(),</a>
<a class="sourceLine" id="cb10-4" title="4">                         <span class="dt">mean_with_insurance =</span> <span class="kw">numeric</span>(), <span class="dt">diff =</span> <span class="kw">numeric</span>())</a>
<a class="sourceLine" id="cb10-5" title="5"><span class="co">### T-test for all variables</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="cf">for</span> (col <span class="cf">in</span> <span class="kw">colnames</span>(data_psm[,<span class="op">-</span><span class="kw">c</span>(<span class="st">&quot;ProcedureID&quot;</span>,<span class="st">&quot;weights&quot;</span>)])) {</a>
<a class="sourceLine" id="cb10-7" title="7">  <span class="cf">if</span> (col <span class="op">==</span><span class="st"> &quot;Insurance&quot;</span>) <span class="cf">next</span></a>
<a class="sourceLine" id="cb10-8" title="8">  zz =<span class="st"> </span><span class="kw">t.test</span>(<span class="kw">get</span>(col)<span class="op">~</span><span class="kw">get</span>(<span class="st">&quot;Insurance&quot;</span>),<span class="dt">data =</span> data_psm)</a>
<a class="sourceLine" id="cb10-9" title="9">  tvalue =<span class="st"> </span>zz<span class="op">$</span>statistic[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb10-10" title="10">  pvalue =<span class="st"> </span>zz<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb10-11" title="11">  mean1 =<span class="st"> </span>zz<span class="op">$</span>estimate[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb10-12" title="12">  mean2 =<span class="st"> </span>zz<span class="op">$</span>estimate[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb10-13" title="13">  temp =<span class="st"> </span>ttest_table_after_match[,<span class="kw">list</span>(<span class="dt">varname =</span> col, <span class="dt">t.value =</span> tvalue,</a>
<a class="sourceLine" id="cb10-14" title="14">                           <span class="dt">p.value =</span> pvalue, <span class="dt">mean_no_insurance =</span> mean1,</a>
<a class="sourceLine" id="cb10-15" title="15">                           <span class="dt">mean_with_insurance =</span> mean2,</a>
<a class="sourceLine" id="cb10-16" title="16">                           <span class="dt">diff =</span> mean1 <span class="op">-</span><span class="st"> </span>mean2)]</a>
<a class="sourceLine" id="cb10-17" title="17">  ttest_table_after_match =<span class="st"> </span><span class="kw">rbind</span>(temp,ttest_table_after_match)</a>
<a class="sourceLine" id="cb10-18" title="18">}</a>
<a class="sourceLine" id="cb10-19" title="19"></a>
<a class="sourceLine" id="cb10-20" title="20"><span class="kw">kable</span>(ttest_table_after_match, <span class="dt">caption =</span> <span class="st">&quot;Matching Results&quot;</span>)</a></code></pre></div>
<table>
<caption>Matching Results</caption>
<thead>
<tr class="header">
<th align="left">varname</th>
<th align="right">t.value</th>
<th align="right">p.value</th>
<th align="right">mean_no_insurance</th>
<th align="right">mean_with_insurance</th>
<th align="right">diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">AvgSales</td>
<td align="right">-1.6649888</td>
<td align="right">0.0963480</td>
<td align="right">1.917119e+00</td>
<td align="right">2.579934e+00</td>
<td align="right">-0.6628154</td>
</tr>
<tr class="even">
<td align="left">GroupPurchase</td>
<td align="right">-0.3170227</td>
<td align="right">0.7513021</td>
<td align="right">1.118721e-01</td>
<td align="right">1.187215e-01</td>
<td align="right">-0.0068493</td>
</tr>
<tr class="odd">
<td align="left">Financing</td>
<td align="right">-0.3132141</td>
<td align="right">0.7541928</td>
<td align="right">7.488584e-01</td>
<td align="right">7.579909e-01</td>
<td align="right">-0.0091324</td>
</tr>
<tr class="even">
<td align="left">Ad</td>
<td align="right">-0.4915656</td>
<td align="right">0.6231502</td>
<td align="right">7.762560e-02</td>
<td align="right">8.675800e-02</td>
<td align="right">-0.0091324</td>
</tr>
<tr class="odd">
<td align="left">ReviewBonus</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">2.283100e-03</td>
<td align="right">2.283100e-03</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">SurgeonNum</td>
<td align="right">0.7556258</td>
<td align="right">0.4500856</td>
<td align="right">1.189498e+00</td>
<td align="right">1.164384e+00</td>
<td align="right">0.0251142</td>
</tr>
<tr class="odd">
<td align="left">Public</td>
<td align="right">0.1368299</td>
<td align="right">0.8911968</td>
<td align="right">6.621000e-02</td>
<td align="right">6.392690e-02</td>
<td align="right">0.0022831</td>
</tr>
<tr class="even">
<td align="left">PriceOrigin</td>
<td align="right">0.6979346</td>
<td align="right">0.4854091</td>
<td align="right">1.183590e+04</td>
<td align="right">1.095673e+04</td>
<td align="right">879.1666667</td>
</tr>
<tr class="odd">
<td align="left">PricePaid</td>
<td align="right">0.3814760</td>
<td align="right">0.7029462</td>
<td align="right">5.622674e+03</td>
<td align="right">5.337893e+03</td>
<td align="right">284.7808219</td>
</tr>
<tr class="even">
<td align="left">PriceDeposit</td>
<td align="right">0.5350583</td>
<td align="right">0.5927462</td>
<td align="right">9.295639e+02</td>
<td align="right">8.740251e+02</td>
<td align="right">55.5388128</td>
</tr>
<tr class="odd">
<td align="left">AvgReviews</td>
<td align="right">-0.0432174</td>
<td align="right">0.9655382</td>
<td align="right">4.229178e-01</td>
<td align="right">4.253067e-01</td>
<td align="right">-0.0023889</td>
</tr>
<tr class="even">
<td align="left">AvgCompNum</td>
<td align="right">-0.7320827</td>
<td align="right">0.4643144</td>
<td align="right">2.288289e+00</td>
<td align="right">2.426153e+00</td>
<td align="right">-0.1378641</td>
</tr>
<tr class="odd">
<td align="left">ProcedureAge</td>
<td align="right">0.1082445</td>
<td align="right">0.9138267</td>
<td align="right">7.047945e+00</td>
<td align="right">7.011416e+00</td>
<td align="right">0.0365297</td>
</tr>
</tbody>
</table>
<p>Notice, the p-value of most variables are larger than .05, which means the characteristics of insured and uninsured procedures are now balanced. Now let’s use the new data for multiple regression.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co">## Multiple linear regression</span></a>
<a class="sourceLine" id="cb11-2" title="2">mlr_after_psm =<span class="st"> </span><span class="kw">lm</span>(AvgSales<span class="op">~</span>Insurance <span class="op">+</span><span class="st"> </span>ProcedureAge <span class="op">+</span><span class="st"> </span>AvgCompNum <span class="op">+</span><span class="st"> </span>AvgReviews <span class="op">+</span><span class="st"> </span>PriceDeposit <span class="op">+</span><span class="st"> </span>PricePaid <span class="op">+</span><span class="st"> </span>PriceOrigin <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>SurgeonNum <span class="op">+</span><span class="st"> </span>ReviewBonus <span class="op">+</span><span class="st"> </span>Ad <span class="op">+</span><span class="st"> </span>Financing <span class="op">+</span><span class="st"> </span>GroupPurchase, <span class="dt">data =</span> data_psm) </a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">## Output the regression results</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="kw">kable</span>(<span class="kw">summary</span>(mlr_after_psm)<span class="op">$</span>coefficients, <span class="dt">caption =</span> <span class="st">&quot;Multiple Linear Regression after PSM Matching&quot;</span>)</a></code></pre></div>
<table>
<caption>Multiple Linear Regression after PSM Matching</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Estimate</th>
<th align="right">Std. Error</th>
<th align="right">t value</th>
<th align="right">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td align="right">-0.3004292</td>
<td align="right">0.8192662</td>
<td align="right">-0.3667053</td>
<td align="right">0.7139289</td>
</tr>
<tr class="even">
<td>Insurance</td>
<td align="right">0.6147844</td>
<td align="right">0.3750604</td>
<td align="right">1.6391608</td>
<td align="right">0.1015447</td>
</tr>
<tr class="odd">
<td>ProcedureAge</td>
<td align="right">-0.0511284</td>
<td align="right">0.0390862</td>
<td align="right">-1.3080933</td>
<td align="right">0.1911904</td>
</tr>
<tr class="even">
<td>AvgCompNum</td>
<td align="right">0.0564913</td>
<td align="right">0.0689969</td>
<td align="right">0.8187511</td>
<td align="right">0.4131547</td>
</tr>
<tr class="odd">
<td>AvgReviews</td>
<td align="right">2.1406980</td>
<td align="right">0.2327374</td>
<td align="right">9.1979123</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td>PriceDeposit</td>
<td align="right">-0.0005943</td>
<td align="right">0.0002827</td>
<td align="right">-2.1025511</td>
<td align="right">0.0357945</td>
</tr>
<tr class="odd">
<td>PricePaid</td>
<td align="right">0.0000506</td>
<td align="right">0.0000486</td>
<td align="right">1.0401751</td>
<td align="right">0.2985502</td>
</tr>
<tr class="even">
<td>PriceOrigin</td>
<td align="right">-0.0000180</td>
<td align="right">0.0000237</td>
<td align="right">-0.7599393</td>
<td align="right">0.4474986</td>
</tr>
<tr class="odd">
<td>Public</td>
<td align="right">0.3053422</td>
<td align="right">0.8853875</td>
<td align="right">0.3448684</td>
<td align="right">0.7302774</td>
</tr>
<tr class="even">
<td>SurgeonNum</td>
<td align="right">0.9260152</td>
<td align="right">0.3919444</td>
<td align="right">2.3626186</td>
<td align="right">0.0183676</td>
</tr>
<tr class="odd">
<td>ReviewBonus</td>
<td align="right">-0.4503987</td>
<td align="right">3.9340714</td>
<td align="right">-0.1144867</td>
<td align="right">0.9088787</td>
</tr>
<tr class="even">
<td>Ad</td>
<td align="right">0.3950722</td>
<td align="right">0.6979243</td>
<td align="right">0.5660674</td>
<td align="right">0.5714953</td>
</tr>
<tr class="odd">
<td>Financing</td>
<td align="right">0.9348327</td>
<td align="right">0.5032972</td>
<td align="right">1.8574169</td>
<td align="right">0.0635927</td>
</tr>
<tr class="even">
<td>GroupPurchase</td>
<td align="right">1.5496654</td>
<td align="right">0.6023791</td>
<td align="right">2.5725751</td>
<td align="right">0.0102608</td>
</tr>
</tbody>
</table>
<p>The effect of insurance with the matched data shows a significant result under .05 significant level.</p>
</div>
</div>
<div id="coarsened-exact-matching" class="section level2">
<h2>Coarsened Exact Matching</h2>
<p>Ideally, if there are exactly same two procedures, one is insured and the other is uninsured, comparing their average monthly sales will lead to a very precise estimate of the effect of insurance. However, it is almost impossible to find the exactly same two procedures. Let’s simply use price as the only characteristic of procedures. Although it is difficult to find two procedures with exactly the same price, we may be able to find one insured procedure whose price is $1,000 and the other uninsured procedure whose price is $1,010. Their prices. If we coarsen the exact number of price to some intervals, for example, we define price less than $500 as low price, $500 to $2,000 as medium price, above $2000 as high price. Then, it will be much easier to find matched sample from insured and uninsured procedures. This is the basic rationale of coarsened exact matching.</p>
<p>Coarsened exact matching allows us to coarsen each covariate automatically or mannually.</p>
<div id="automatical-coarsening" class="section level3">
<h3>Automatical Coarsening</h3>
<p>Coarsened exact matching allows us to coarsen each covariate automatically or mannually. Without any priori knowledge, we can first try automatical coarsening. Several options are available such as “sturges”. How to choose the appropriate option depends on the distribution of the variables. Notice, there is no sense to coarsen dummy variables (i.e., binary variables) since they are already “coarsened” into two categories. In our case, ProcedureAge, AvgCompNum, AvgReviews, PriceDeposit, PricePaid, and PriceOrigin are continuous variables. We use “sturges” option to coarsen these continuous variables. SurgeonNum is a categorical variable including five categories, we coarsen it into two categories: procedures that one or less physician is available, and procedures that multiple physicians are available. All the other variables are dummies, so we use 0.5 as the cut point to keep them unchanged. You can also use any number strictly between 0 and 1 as the cut point.</p>
<p>The following codes show how we coarsen each variable</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">cut_auto =<span class="st"> </span><span class="kw">list</span>(<span class="dt">PriceDeposit =</span> <span class="st">&quot;sturges&quot;</span>,<span class="dt">PricePaid =</span> <span class="st">&quot;sturges&quot;</span>, <span class="dt">PriceOrigin =</span> <span class="st">&quot;sturges&quot;</span>,<span class="dt">ProcedureAge =</span> <span class="st">&quot;sturges&quot;</span>, <span class="dt">AvgCompNum =</span> <span class="st">&quot;sturges&quot;</span>, <span class="dt">SurgeonNum =</span> <span class="kw">c</span>(<span class="fl">1.5</span>), <span class="dt">AvgReviews =</span> <span class="st">&quot;sturges&quot;</span>, <span class="dt">Public =</span> <span class="kw">c</span>(<span class="fl">0.5</span>), <span class="dt">ReviewBonus =</span> <span class="kw">c</span>(<span class="fl">0.5</span>),<span class="dt">Ad =</span> <span class="kw">c</span>(<span class="fl">0.5</span>),<span class="dt">Financing =</span> <span class="kw">c</span>(<span class="fl">0.5</span>),<span class="dt">GroupPurchase =</span> <span class="kw">c</span>(<span class="fl">0.5</span>))</a></code></pre></div>
<p>We first check imbalance before matching.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">imbalance</span>(data<span class="op">$</span>Insurance, data, <span class="dt">drop=</span><span class="kw">c</span>(<span class="st">&quot;ProcedureID&quot;</span>,<span class="st">&quot;AvgSales&quot;</span>,<span class="st">&quot;Insurance&quot;</span>), <span class="dt">breaks =</span> cut_auto)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co">#&gt; Multivariate Imbalance Measure: L1=0.573</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co">#&gt; Percentage of local common support: LCS=17.6%</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="co">#&gt; Univariate Imbalance Measures:</span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="co">#&gt;                   statistic   type          L1  min           25%           50%</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="co">#&gt; ProcedureAge  -5.592392e-01 (diff) 0.091366236    0  0.000000e+00    0.00000000</span></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="co">#&gt; AvgCompNum    -2.766494e+00 (diff) 0.274367237    0 -7.500000e-01   -1.50000000</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="co">#&gt; AvgReviews    -6.514174e-02 (diff) 0.013086746    0 -9.090909e-02   -0.07352941</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="co">#&gt; PriceDeposit   2.080239e+02 (diff) 0.098035841  -19 -5.600000e+01  -63.00000000</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="co">#&gt; PricePaid      2.420125e+03 (diff) 0.083560550  -89 -3.810000e+02 -420.00000000</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="co">#&gt; PriceOrigin    4.306789e+03 (diff) 0.135712450 -581 -1.700000e+03    0.00000000</span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="co">#&gt; Public        -2.689186e-02 (diff) 0.026891863    0  0.000000e+00    0.00000000</span></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="co">#&gt; SurgeonNum    -2.836647e-01 (diff) 0.000000000    0  0.000000e+00    0.00000000</span></a>
<a class="sourceLine" id="cb13-17" title="17"><span class="co">#&gt; ReviewBonus    1.354118e-03 (diff) 0.001354118    0  0.000000e+00    0.00000000</span></a>
<a class="sourceLine" id="cb13-18" title="18"><span class="co">#&gt; Ad            -6.970953e-02 (diff) 0.069709530    0  0.000000e+00    0.00000000</span></a>
<a class="sourceLine" id="cb13-19" title="19"><span class="co">#&gt; Financing     -9.611712e-02 (diff) 0.096117124    0 -1.000000e+00    0.00000000</span></a>
<a class="sourceLine" id="cb13-20" title="20"><span class="co">#&gt; GroupPurchase -4.761216e-02 (diff) 0.047612162    0  0.000000e+00    0.00000000</span></a>
<a class="sourceLine" id="cb13-21" title="21"><span class="co">#&gt;                       75%   max</span></a>
<a class="sourceLine" id="cb13-22" title="22"><span class="co">#&gt; ProcedureAge     0.000000     3</span></a>
<a class="sourceLine" id="cb13-23" title="23"><span class="co">#&gt; AvgCompNum      -4.333333    -9</span></a>
<a class="sourceLine" id="cb13-24" title="24"><span class="co">#&gt; AvgReviews       0.000000    -5</span></a>
<a class="sourceLine" id="cb13-25" title="25"><span class="co">#&gt; PriceDeposit   438.000000     0</span></a>
<a class="sourceLine" id="cb13-26" title="26"><span class="co">#&gt; PricePaid     3200.000000 82000</span></a>
<a class="sourceLine" id="cb13-27" title="27"><span class="co">#&gt; PriceOrigin   7000.000000 18999</span></a>
<a class="sourceLine" id="cb13-28" title="28"><span class="co">#&gt; Public           0.000000     0</span></a>
<a class="sourceLine" id="cb13-29" title="29"><span class="co">#&gt; SurgeonNum      -1.000000    -2</span></a>
<a class="sourceLine" id="cb13-30" title="30"><span class="co">#&gt; ReviewBonus      0.000000     0</span></a>
<a class="sourceLine" id="cb13-31" title="31"><span class="co">#&gt; Ad               0.000000     0</span></a>
<a class="sourceLine" id="cb13-32" title="32"><span class="co">#&gt; Financing        0.000000     0</span></a>
<a class="sourceLine" id="cb13-33" title="33"><span class="co">#&gt; GroupPurchase    0.000000     0</span></a></code></pre></div>
<p>We next run CEM with automatical coarsening.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">cem_auto &lt;-<span class="st"> </span><span class="kw">cem</span>(<span class="dt">treatment =</span> <span class="st">&quot;Insurance&quot;</span>, <span class="dt">data =</span> data, <span class="dt">cutpoints =</span> cut_auto, <span class="dt">keep.all=</span><span class="ot">TRUE</span>,<span class="dt">eval.imbalance =</span> <span class="ot">TRUE</span>, <span class="dt">drop =</span> <span class="kw">c</span>(<span class="st">&quot;ProcedureID&quot;</span>,<span class="st">&quot;AvgSales&quot;</span>,<span class="st">&quot;Insurance&quot;</span>), <span class="dt">L1.breaks =</span> cut_auto )</a></code></pre></div>
<p>How to choose the appropriate option for automatical coarsening depends on the distribution of the variables. For example, sturges rule works well for normally distributed variable. Therefore, it is important to check the distributions of all continuous variables before matching. The following histogram shows that most variables are highly right-skewed. Therefore, using “sturges” rule as the approach of automatical coarsening may not be a good choice.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb15-2" title="2">ProcedureAgeHist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x=</span>ProcedureAge)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;ProcedureAge&quot;</span>)</a>
<a class="sourceLine" id="cb15-4" title="4"></a>
<a class="sourceLine" id="cb15-5" title="5">AvgCompNumHist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x=</span>AvgCompNum)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;AvgCompNum&quot;</span>)</a>
<a class="sourceLine" id="cb15-7" title="7"></a>
<a class="sourceLine" id="cb15-8" title="8">AvgReviewsHist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x=</span>AvgReviews)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;AvgReviews&quot;</span>)</a>
<a class="sourceLine" id="cb15-10" title="10"></a>
<a class="sourceLine" id="cb15-11" title="11">PriceDepositHist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x=</span>PriceDeposit)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;PriceDeposit&quot;</span>)</a>
<a class="sourceLine" id="cb15-13" title="13"></a>
<a class="sourceLine" id="cb15-14" title="14">PricePaidHist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data[PricePaid<span class="op">&lt;</span><span class="dv">150000</span>], <span class="kw">aes</span>(<span class="dt">x=</span>PricePaid)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb15-15" title="15"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;PricePaid&quot;</span>)</a>
<a class="sourceLine" id="cb15-16" title="16"></a>
<a class="sourceLine" id="cb15-17" title="17">PriceOriginHist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x=</span>PriceOrigin)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb15-18" title="18"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;PriceOrigin&quot;</span>)</a>
<a class="sourceLine" id="cb15-19" title="19"></a>
<a class="sourceLine" id="cb15-20" title="20">SurgeonNumHist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x=</span>SurgeonNum)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb15-21" title="21"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;SurgeonNum&quot;</span>)</a>
<a class="sourceLine" id="cb15-22" title="22"></a>
<a class="sourceLine" id="cb15-23" title="23"><span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb15-24" title="24"><span class="kw">grid.arrange</span>( ProcedureAgeHist, AvgCompNumHist,AvgReviewsHist,PriceDepositHist,PricePaidHist,PriceOriginHist,SurgeonNumHist, <span class="dt">ncol=</span><span class="dv">3</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="manual-coarsening" class="section level3">
<h3>Manual Coarsening</h3>
<p>In practice, manual coarsening is more reasonable. For example, if the range of price is from $100 to $100,00, we can separate this interval into three pieces with two cut points (e.g., $499.5 and $1999.5):</p>
<ul>
<li>$100-$500: low price</li>
<li>$500-$2000: medium price</li>
<li>$2000-$100,00: high price</li>
</ul>
<p>Notice, how to coarsen a variable highly depends on priori knowledge. In this situation, consulting a physician could help a lot. The downside of it is that people may critisize the coarsening is very arbitrary and could be an “artifact” to make the matching result better than real. The following codes show how to define cut points with R and how to use manually defined coarsening for CEM.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co">## Define cut points</span></a>
<a class="sourceLine" id="cb16-2" title="2">PriceDepositCut =<span class="st"> </span><span class="kw">c</span>(<span class="fl">99.5</span>,<span class="fl">999.5</span>)</a>
<a class="sourceLine" id="cb16-3" title="3">PricePaidCut =<span class="st"> </span><span class="kw">c</span>(<span class="fl">999.5</span>,<span class="fl">4999.5</span>,<span class="fl">9999.5</span>)</a>
<a class="sourceLine" id="cb16-4" title="4">PriceOriginCut =<span class="st"> </span><span class="kw">c</span>(<span class="fl">999.5</span>,<span class="fl">4999.5</span>,<span class="fl">9999.5</span>)</a>
<a class="sourceLine" id="cb16-5" title="5">ProcedureAgeCut =<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb16-6" title="6">AvgCompNumCut =<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb16-7" title="7">SurgeonNumCut =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="fl">1.5</span>)</a>
<a class="sourceLine" id="cb16-8" title="8">AvgReviewsCut =<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb16-9" title="9"></a>
<a class="sourceLine" id="cb16-10" title="10"><span class="co">## Save the cut points into a list</span></a>
<a class="sourceLine" id="cb16-11" title="11">cut_man =<span class="st"> </span><span class="kw">list</span>(<span class="dt">ProcedureAge =</span> ProcedureAgeCut, <span class="dt">AvgCompNum =</span> AvgCompNumCut, <span class="dt">AvgReviews =</span> AvgReviewsCut, <span class="dt">PriceDeposit =</span> PriceDepositCut, <span class="dt">PricePaid =</span> PricePaidCut, <span class="dt">PriceOrigin =</span> PriceOriginCut,  <span class="dt">SurgeonNum =</span> SurgeonNumCut,<span class="dt">Public =</span> <span class="kw">c</span>(<span class="fl">0.5</span>), <span class="dt">ReviewBonus =</span> <span class="kw">c</span>(<span class="fl">0.5</span>),<span class="dt">Ad =</span> <span class="kw">c</span>(<span class="fl">0.5</span>),<span class="dt">Financing =</span> <span class="kw">c</span>(<span class="fl">0.5</span>),<span class="dt">GroupPurchase =</span> <span class="kw">c</span>(<span class="fl">0.5</span>))</a></code></pre></div>
<p>After defining the cut points, we can run CEM with the manual coarsening. We first check the imbalance of our data.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co">### Imbalance before matching</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="kw">imbalance</span>(data<span class="op">$</span>Insurance, data, <span class="dt">drop=</span><span class="kw">c</span>(<span class="st">&quot;ProcedureID&quot;</span>,<span class="st">&quot;AvgSales&quot;</span>, <span class="st">&quot;Insurance&quot;</span>), <span class="dt">breaks =</span> cut_man)</a>
<a class="sourceLine" id="cb17-3" title="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="co">#&gt; Multivariate Imbalance Measure: L1=0.377</span></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="co">#&gt; Percentage of local common support: LCS=50.8%</span></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-7" title="7"><span class="co">#&gt; Univariate Imbalance Measures:</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="co">#&gt;                   statistic   type          L1  min           25%           50%</span></a>
<a class="sourceLine" id="cb17-10" title="10"><span class="co">#&gt; ProcedureAge  -5.592392e-01 (diff) 0.000000000    0  0.000000e+00    0.00000000</span></a>
<a class="sourceLine" id="cb17-11" title="11"><span class="co">#&gt; AvgCompNum    -2.766494e+00 (diff) 0.000000000    0 -7.500000e-01   -1.50000000</span></a>
<a class="sourceLine" id="cb17-12" title="12"><span class="co">#&gt; AvgReviews    -6.514174e-02 (diff) 0.000000000    0 -9.090909e-02   -0.07352941</span></a>
<a class="sourceLine" id="cb17-13" title="13"><span class="co">#&gt; PriceDeposit   2.080239e+02 (diff) 0.000000000  -19 -5.600000e+01  -63.00000000</span></a>
<a class="sourceLine" id="cb17-14" title="14"><span class="co">#&gt; PricePaid      2.420125e+03 (diff) 0.000000000  -89 -3.810000e+02 -420.00000000</span></a>
<a class="sourceLine" id="cb17-15" title="15"><span class="co">#&gt; PriceOrigin    4.306789e+03 (diff) 0.000000000 -581 -1.700000e+03    0.00000000</span></a>
<a class="sourceLine" id="cb17-16" title="16"><span class="co">#&gt; Public        -2.689186e-02 (diff) 0.026891863    0  0.000000e+00    0.00000000</span></a>
<a class="sourceLine" id="cb17-17" title="17"><span class="co">#&gt; SurgeonNum    -2.836647e-01 (diff) 0.093587907    0  0.000000e+00    0.00000000</span></a>
<a class="sourceLine" id="cb17-18" title="18"><span class="co">#&gt; ReviewBonus    1.354118e-03 (diff) 0.001354118    0  0.000000e+00    0.00000000</span></a>
<a class="sourceLine" id="cb17-19" title="19"><span class="co">#&gt; Ad            -6.970953e-02 (diff) 0.069709530    0  0.000000e+00    0.00000000</span></a>
<a class="sourceLine" id="cb17-20" title="20"><span class="co">#&gt; Financing     -9.611712e-02 (diff) 0.096117124    0 -1.000000e+00    0.00000000</span></a>
<a class="sourceLine" id="cb17-21" title="21"><span class="co">#&gt; GroupPurchase -4.761216e-02 (diff) 0.047612162    0  0.000000e+00    0.00000000</span></a>
<a class="sourceLine" id="cb17-22" title="22"><span class="co">#&gt;                       75%   max</span></a>
<a class="sourceLine" id="cb17-23" title="23"><span class="co">#&gt; ProcedureAge     0.000000     3</span></a>
<a class="sourceLine" id="cb17-24" title="24"><span class="co">#&gt; AvgCompNum      -4.333333    -9</span></a>
<a class="sourceLine" id="cb17-25" title="25"><span class="co">#&gt; AvgReviews       0.000000    -5</span></a>
<a class="sourceLine" id="cb17-26" title="26"><span class="co">#&gt; PriceDeposit   438.000000     0</span></a>
<a class="sourceLine" id="cb17-27" title="27"><span class="co">#&gt; PricePaid     3200.000000 82000</span></a>
<a class="sourceLine" id="cb17-28" title="28"><span class="co">#&gt; PriceOrigin   7000.000000 18999</span></a>
<a class="sourceLine" id="cb17-29" title="29"><span class="co">#&gt; Public           0.000000     0</span></a>
<a class="sourceLine" id="cb17-30" title="30"><span class="co">#&gt; SurgeonNum      -1.000000    -2</span></a>
<a class="sourceLine" id="cb17-31" title="31"><span class="co">#&gt; ReviewBonus      0.000000     0</span></a>
<a class="sourceLine" id="cb17-32" title="32"><span class="co">#&gt; Ad               0.000000     0</span></a>
<a class="sourceLine" id="cb17-33" title="33"><span class="co">#&gt; Financing        0.000000     0</span></a>
<a class="sourceLine" id="cb17-34" title="34"><span class="co">#&gt; GroupPurchase    0.000000     0</span></a></code></pre></div>
<p>Next, we run the command for CEM.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="co">### CEM matching</span></a>
<a class="sourceLine" id="cb18-2" title="2">cem_man &lt;-<span class="st"> </span><span class="kw">cem</span>(<span class="dt">treatment =</span> <span class="st">&quot;Insurance&quot;</span>, <span class="dt">data =</span> data, <span class="dt">keep.all=</span><span class="ot">TRUE</span>, <span class="dt">eval.imbalance =</span> <span class="ot">TRUE</span>, <span class="dt">drop =</span> <span class="kw">c</span>(<span class="st">&quot;ProcedureID&quot;</span>,<span class="st">&quot;Insurance&quot;</span>,  <span class="st">&quot;AvgSales&quot;</span>),<span class="dt">cutpoints =</span> cut_man, <span class="dt">L1.breaks =</span> cut_man )</a></code></pre></div>
</div>
<div id="use-the-results-of-cem" class="section level3">
<h3>Use the results of CEM</h3>
<p>Here, we take the manual coarsening as example to show how to use the results of CEM. First, as what we did for PSM, we select the weight and combine it with the original data.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">data_cem_man =<span class="st"> </span><span class="kw">cbind</span>(data, <span class="dt">weight =</span> cem_man<span class="op">$</span>w)</a>
<a class="sourceLine" id="cb19-2" title="2"></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="kw">summary</span>(data_cem_man<span class="op">$</span>weight)</a>
<a class="sourceLine" id="cb19-4" title="4"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="co">#&gt;  0.0000  0.6714  1.0000  0.9039  1.0000 18.9914</span></a></code></pre></div>
<p>Different from the results of PSM, the weights CEM generates is not just 0 or 1. To use the matching data from regression, we can run weighted regression such that:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">mlr_after_cem =<span class="st"> </span><span class="kw">lm</span>(AvgSales<span class="op">~</span>Insurance <span class="op">+</span><span class="st"> </span>ProcedureAge <span class="op">+</span><span class="st"> </span>AvgCompNum <span class="op">+</span><span class="st"> </span>AvgReviews <span class="op">+</span><span class="st"> </span>PriceDeposit <span class="op">+</span><span class="st"> </span>PricePaid <span class="op">+</span><span class="st"> </span>PriceOrigin <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>SurgeonNum <span class="op">+</span><span class="st"> </span>ReviewBonus <span class="op">+</span><span class="st"> </span>Ad <span class="op">+</span><span class="st"> </span>Financing <span class="op">+</span><span class="st"> </span>GroupPurchase, <span class="dt">data =</span> data_cem_man, <span class="dt">weights =</span> weight) </a>
<a class="sourceLine" id="cb20-2" title="2"></a>
<a class="sourceLine" id="cb20-3" title="3"><span class="kw">kable</span>(<span class="kw">summary</span>(mlr_after_cem)<span class="op">$</span>coefficients, <span class="dt">caption =</span> <span class="st">&quot;Multiple Linear Regression after CEM Matching&quot;</span>)</a></code></pre></div>
<table>
<caption>Multiple Linear Regression after CEM Matching</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Estimate</th>
<th align="right">Std. Error</th>
<th align="right">t value</th>
<th align="right">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td align="right">-1.2683993</td>
<td align="right">0.6832433</td>
<td align="right">-1.8564387</td>
<td align="right">0.0636400</td>
</tr>
<tr class="even">
<td>Insurance</td>
<td align="right">0.9882120</td>
<td align="right">0.3718907</td>
<td align="right">2.6572650</td>
<td align="right">0.0079840</td>
</tr>
<tr class="odd">
<td>ProcedureAge</td>
<td align="right">-0.0256363</td>
<td align="right">0.0365670</td>
<td align="right">-0.7010776</td>
<td align="right">0.4833927</td>
</tr>
<tr class="even">
<td>AvgCompNum</td>
<td align="right">0.2290788</td>
<td align="right">0.0442364</td>
<td align="right">5.1785115</td>
<td align="right">0.0000003</td>
</tr>
<tr class="odd">
<td>AvgReviews</td>
<td align="right">2.8073485</td>
<td align="right">0.2267209</td>
<td align="right">12.3823976</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td>PriceDeposit</td>
<td align="right">-0.0007246</td>
<td align="right">0.0002793</td>
<td align="right">-2.5945596</td>
<td align="right">0.0095885</td>
</tr>
<tr class="odd">
<td>PricePaid</td>
<td align="right">0.0000019</td>
<td align="right">0.0000439</td>
<td align="right">0.0425514</td>
<td align="right">0.9660663</td>
</tr>
<tr class="even">
<td>PriceOrigin</td>
<td align="right">0.0000183</td>
<td align="right">0.0000235</td>
<td align="right">0.7789059</td>
<td align="right">0.4361912</td>
</tr>
<tr class="odd">
<td>Public</td>
<td align="right">0.4895426</td>
<td align="right">0.7965691</td>
<td align="right">0.6145638</td>
<td align="right">0.5389612</td>
</tr>
<tr class="even">
<td>SurgeonNum</td>
<td align="right">0.4790470</td>
<td align="right">0.3662659</td>
<td align="right">1.3079216</td>
<td align="right">0.1911544</td>
</tr>
<tr class="odd">
<td>Ad</td>
<td align="right">-0.5002975</td>
<td align="right">0.6837790</td>
<td align="right">-0.7316655</td>
<td align="right">0.4645179</td>
</tr>
<tr class="even">
<td>Financing</td>
<td align="right">1.6503654</td>
<td align="right">0.5139799</td>
<td align="right">3.2109533</td>
<td align="right">0.0013586</td>
</tr>
<tr class="odd">
<td>GroupPurchase</td>
<td align="right">0.5724261</td>
<td align="right">0.5674288</td>
<td align="right">1.0088069</td>
<td align="right">0.3132739</td>
</tr>
</tbody>
</table>
<p>From the above results, the impact of insurance is positive under .01 significant level.</p>
</div>
</div>
<div id="notes" class="section level2">
<h2>Notes</h2>
<ul>
<li><p>The above t-test is not strict enough since variables are not normally distributed and may also be not independent since two procedures from the same hospital could be correlated. One can use some non-parametric methods when assumptions do not hold such as Wilcoxon signed-rank test.</p></li>
<li><p>CEM dominates PSM and we recommend using CEM instead of PSM. The reason has been explained above: PSM tries to mimic random experiment whose expectation of bias is 0 but CEM tries mimic an experiment with exactly same paired subjects (which is called fully blocked randomized experiment) whose bias is designed to be 0. However, CEM needs us to have some priori knowledge about the covariates to coarsen them.</p></li>
<li><p>All the matching methods are based on observable covariates that exist in our dataset. If the assignment depends on unobservable confounders, there could still be bias after matching. Matching can help us reduce the unbalance between the treatment and control groups only based on observable characteristics.</p></li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
