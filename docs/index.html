<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="OPIM 5510 - Web Analytics, Instructor: Xinxin Li" />


<title>A Tutorial to Matching</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">A Tutorial to Matching</h1>
<h4 class="author">OPIM 5510 - Web Analytics, Instructor: <a href="https://www.business.uconn.edu/person/xinxin-li/">Xinxin Li</a></h4>
<h4 class="date">Last Updated: February 13, 2020</h4>



<p>This tutorial uses an empirical example to describe matching strategies. The data source is used in a working paper written by:</p>
<p><a href="https://www.hongfei-business.com/">Hongfei Li</a> <a href="https://www.business.uconn.edu/person/jing-peng/">Jing Peng</a> <a href="https://www.business.uconn.edu/person/xinxin-li/">Xinxin Li</a> <a href="https://www.business.uconn.edu/person/jan-stallaert/">Jan Stallaert</a></p>
<p>All the data source and R codes can be found <a href="https://github.com/HongfeiUconn/Matching_Tutorial">here</a>.</p>
<div id="import-libraries" class="section level2">
<h2>Import libraries</h2>
<ul>
<li>All data filter and rearrangement are based on package <a href="https://cran.r-project.org/web/packages/data.table/data.table.pdf">data.table</a>.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(cem)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">#&gt; Loading required package: tcltk</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#&gt; Loading required package: lattice</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">#&gt; </span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#&gt; How to use CEM? Type vignette(&quot;cem&quot;)</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">library</span>(data.table)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">library</span>(MatchIt)</span></code></pre></div>
</div>
<div id="empirical-context" class="section level2">
<h2>Empirical Context</h2>
<p>Our context is one of the largest online platforms for cosmetic procedures in China. It allows customers to make appointments for a cosmetic procedure offered by a specific hospital online by paying a certain amount of deposit. Then the customer goes offline to pay the rest of the price and take the surgery.</p>
<p>The platform offers a complication insurance policy, which aims at compensating customers for surgical malpractice or post-treatment complications such as severe infection. However, this insurance policy is only available for a subset of procedures. We are interested in whether the insurance has any effect on the average sales of procedures.</p>
</div>
<div id="explore-data" class="section level2">
<h2>Explore Data</h2>
<div id="read-data" class="section level3">
<h3>Read Data</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>data =<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data.csv&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">colnames</span>(data)</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt;  [1] &quot;ProcedureID&quot;   &quot;ProcedureAge&quot;  &quot;AvgCompNum&quot;    &quot;AvgReviews&quot;   </span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt;  [5] &quot;PriceDeposit&quot;  &quot;PricePaid&quot;     &quot;PriceOrigin&quot;   &quot;Public&quot;       </span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt;  [9] &quot;SurgeonNum&quot;    &quot;ReviewBonus&quot;   &quot;Ad&quot;            &quot;Financing&quot;    </span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt; [13] &quot;GroupPurchase&quot; &quot;Insurance&quot;     &quot;AvgSales&quot;</span></span></code></pre></div>
</div>
<div id="description-of-variables" class="section level3">
<h3>Description of Variables</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">## Read data fastly</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>description =<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;description.csv&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">## Description of Variables </span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="kw">library</span>(knitr)</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw">kable</span>(description, <span class="dt">caption =</span> <span class="st">&quot;Description of Variables&quot;</span>)</span></code></pre></div>
<table>
<caption>Description of Variables</caption>
<thead>
<tr class="header">
<th align="left">Variables</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ProcedureAge</td>
<td align="left">The number of months since a procedure was first available when the complication insurance was introduced</td>
</tr>
<tr class="even">
<td align="left">AvgCompNum</td>
<td align="left">Average monthly number of competitors</td>
</tr>
<tr class="odd">
<td align="left">AvgReviews</td>
<td align="left">Average monthly number of reviews</td>
</tr>
<tr class="even">
<td align="left">PriceDeposit</td>
<td align="left">The amount of deposit for the procedure</td>
</tr>
<tr class="odd">
<td align="left">PricePaid</td>
<td align="left">The effective price for the procedure, net of discounts</td>
</tr>
<tr class="even">
<td align="left">PriceOrigin</td>
<td align="left">The original price of the procedure</td>
</tr>
<tr class="odd">
<td align="left">SurgeonNum</td>
<td align="left">The number of surgeons available for the procedure</td>
</tr>
<tr class="even">
<td align="left">Public</td>
<td align="left">Dummy. Whether this procedure is performed by a public hospital</td>
</tr>
<tr class="odd">
<td align="left">ReviewBonus</td>
<td align="left">Dummy. Whether the provider offers a bonus for users to write reviews</td>
</tr>
<tr class="even">
<td align="left">Ad</td>
<td align="left">Dummy. Whether there is an ad on the webpage of this procedure</td>
</tr>
<tr class="odd">
<td align="left">Financing</td>
<td align="left">Dummy. Whether this procedure supports financing</td>
</tr>
<tr class="even">
<td align="left">GroupPurchase</td>
<td align="left">Dummy. Whether this procedure supports group purchasing</td>
</tr>
</tbody>
</table>
<p>Here, AvgSales is the dependent (or outcome) variable and Insurance is the treatment variable. When Insurance equals to 0, it means this procedure is not offered the complication insurance option, 1 otherwise.</p>
</div>
<div id="motivation" class="section level3">
<h3>Motivation</h3>
<p>To answer the above question, one can first come up with simple linear regression.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">## Simple linear regression</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>slr_no_match =<span class="st"> </span><span class="kw">lm</span>(AvgSales<span class="op">~</span>Insurance, <span class="dt">data =</span> data) </span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">## Output the regression results</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="kw">summary</span>(slr_no_match)</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt; </span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt; Call:</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt; lm(formula = AvgSales ~ Insurance, data = data)</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt; </span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt; -3.542 -2.685 -1.586 -0.296 99.818 </span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt; </span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt; (Intercept)    1.746      0.250   6.983 4.57e-12 ***</span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt; Insurance      1.797      0.360   4.991 6.81e-07 ***</span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#&gt; ---</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co">#&gt; </span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="co">#&gt; Residual standard error: 6.538 on 1319 degrees of freedom</span></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co">#&gt; Multiple R-squared:  0.01853,    Adjusted R-squared:  0.01779 </span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co">#&gt; F-statistic: 24.91 on 1 and 1319 DF,  p-value: 6.813e-07</span></span></code></pre></div>
<p>From the above results, the effect of insurance is significantly positive. Next, we use multiple linear regression, which is more robust than simple linear regression.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">## Multiple linear regression</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>mlr_no_match =<span class="st"> </span><span class="kw">lm</span>(AvgSales<span class="op">~</span>Insurance <span class="op">+</span><span class="st"> </span>ProcedureAge <span class="op">+</span><span class="st"> </span>AvgCompNum <span class="op">+</span><span class="st"> </span>AvgReviews <span class="op">+</span><span class="st"> </span>PriceDeposit <span class="op">+</span><span class="st"> </span>PricePaid <span class="op">+</span><span class="st"> </span>PriceOrigin <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>SurgeonNum <span class="op">+</span><span class="st"> </span>ReviewBonus <span class="op">+</span><span class="st"> </span>Ad <span class="op">+</span><span class="st"> </span>Financing <span class="op">+</span><span class="st"> </span>GroupPurchase, <span class="dt">data =</span> data) </span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">## Output the regression results</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="kw">summary</span>(mlr_no_match)</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#&gt; </span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt; Call:</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt; lm(formula = AvgSales ~ Insurance + ProcedureAge + AvgCompNum + </span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt;     AvgReviews + PriceDeposit + PricePaid + PriceOrigin + Public + </span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt;     SurgeonNum + ReviewBonus + Ad + Financing + GroupPurchase, </span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt;     data = data)</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt; </span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co">#&gt; -37.216  -2.178  -0.852   0.639  90.460 </span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co">#&gt; </span></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="co">#&gt;                 Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="co">#&gt; (Intercept)   -3.290e-01  5.732e-01  -0.574  0.56603    </span></span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="co">#&gt; Insurance      5.401e-01  3.676e-01   1.469  0.14202    </span></span>
<span id="cb5-20"><a href="#cb5-20"></a><span class="co">#&gt; ProcedureAge  -3.821e-02  3.462e-02  -1.104  0.26987    </span></span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="co">#&gt; AvgCompNum     2.528e-01  4.330e-02   5.838 6.67e-09 ***</span></span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="co">#&gt; AvgReviews     2.742e+00  2.253e-01  12.173  &lt; 2e-16 ***</span></span>
<span id="cb5-23"><a href="#cb5-23"></a><span class="co">#&gt; PriceDeposit  -6.512e-04  2.178e-04  -2.990  0.00284 ** </span></span>
<span id="cb5-24"><a href="#cb5-24"></a><span class="co">#&gt; PricePaid      8.307e-06  3.305e-05   0.251  0.80157    </span></span>
<span id="cb5-25"><a href="#cb5-25"></a><span class="co">#&gt; PriceOrigin    7.433e-06  1.872e-05   0.397  0.69138    </span></span>
<span id="cb5-26"><a href="#cb5-26"></a><span class="co">#&gt; Public         2.345e-02  7.857e-01   0.030  0.97619    </span></span>
<span id="cb5-27"><a href="#cb5-27"></a><span class="co">#&gt; SurgeonNum     2.500e-01  3.052e-01   0.819  0.41291    </span></span>
<span id="cb5-28"><a href="#cb5-28"></a><span class="co">#&gt; ReviewBonus   -6.197e-01  3.490e+00  -0.178  0.85911    </span></span>
<span id="cb5-29"><a href="#cb5-29"></a><span class="co">#&gt; Ad             8.924e-01  6.152e-01   1.451  0.14713    </span></span>
<span id="cb5-30"><a href="#cb5-30"></a><span class="co">#&gt; Financing      1.251e+00  4.258e-01   2.937  0.00337 ** </span></span>
<span id="cb5-31"><a href="#cb5-31"></a><span class="co">#&gt; GroupPurchase  1.301e+00  5.307e-01   2.452  0.01435 *  </span></span>
<span id="cb5-32"><a href="#cb5-32"></a><span class="co">#&gt; ---</span></span>
<span id="cb5-33"><a href="#cb5-33"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb5-34"><a href="#cb5-34"></a><span class="co">#&gt; </span></span>
<span id="cb5-35"><a href="#cb5-35"></a><span class="co">#&gt; Residual standard error: 6.005 on 1307 degrees of freedom</span></span>
<span id="cb5-36"><a href="#cb5-36"></a><span class="co">#&gt; Multiple R-squared:  0.1796, Adjusted R-squared:  0.1714 </span></span>
<span id="cb5-37"><a href="#cb5-37"></a><span class="co">#&gt; F-statistic:    22 on 13 and 1307 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>From the above results, the effect of insurance is not significant anymore after controlling for all the covariates.</p>
</div>
<div id="why-do-we-want-to-use-matching" class="section level3">
<h3>Why do we want to use matching?</h3>
<p>Suppose in an ideal situation, one procedure is insured and uninsured at the same time, then if we take the difference of the average monthly sales under the insured and uninsured situations, we can get a precise measurement of the impact of the insurance policy. However, one procedure can either be insured or uninsured, but it can never be in these two situations simultaneously, unless we have a parallel universe (which is called “counterfactual” in the literature of causal inference). To solve this issue, we may have the following two options:</p>
<ul>
<li><p>For each insured procedure, find an uninsured procedure which is exactly same with this insured procedure in terms of all characteristics such as the procedure type, price, hospital, number of reviews, etc. In this situation, although the two procedures are “two” procedures, they can still be treated as the same one since there are no difference between them except for whether they are insured, just like a comparison between twins. It can be shown that the bias of the estimation of the effect of insurance is designed to be 0 in this situation. Coarsened exact matching (CEM) refers to this idea.</p></li>
<li><p>For each insured procedure, suppose the probability of this procedure is chosen to the insured group is <span class="math inline">\(p\)</span>, we need find an uninsured procedure whose probability of this procedure is chosen to the insured group is also <span class="math inline">\(p\)</span>. For example, flipping a fair coin to randomly assign the procedures into the insured or uninsured group. This means each procedure is equally likely to be assigned the insurance policy with probability 0.5. You can also use random number or toll a die to assign the procedures into the insured and uninsured groups, as long as you can guarantee a pair of procedures have the same chance to be assigned with the insurance. But in real world, we cannot assign the insurance by ourselves because everything has already been determined by the company. The only data we can use is observational but not experimental. However, if we happen to find two procedures—one insured and the other one uninsured—with the same probability to be assigned the insurance, we can solve the problem! This is the basic idea of propensity score matching. Then comparing the difference between their average monthly sales is an unbiased estimator of the effect of the insurance policy. It can be shown that the expectation of the bias of the estimation of the effect of insurance is 0. When the sample size is large enough, the bias becomes very close to 0 by law of large number.</p></li>
</ul>
</div>
</div>
<div id="propensity-score-matching" class="section level2">
<h2>Propensity Score Matching</h2>
<div id="compare-the-mean" class="section level3">
<h3>Compare the Mean</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">### Create blank data table</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>ttest_table_before_match =<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">varname =</span><span class="kw">character</span>(), <span class="dt">t.value=</span><span class="kw">numeric</span>(),</span>
<span id="cb6-3"><a href="#cb6-3"></a>                         <span class="dt">p.value =</span> <span class="kw">numeric</span>(), <span class="dt">mean_no_insurance =</span> <span class="kw">numeric</span>(),</span>
<span id="cb6-4"><a href="#cb6-4"></a>                         <span class="dt">mean_with_insurance =</span> <span class="kw">numeric</span>(), <span class="dt">diff =</span> <span class="kw">numeric</span>())</span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">### T-test for all variables</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="kw">colnames</span>(data)) {</span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="cf">if</span> (col <span class="op">==</span><span class="st"> &quot;Insurance&quot;</span> <span class="op">|</span><span class="st"> </span>col <span class="op">==</span><span class="st"> &quot;ProcedureID&quot;</span>) <span class="cf">next</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>  zz =<span class="st"> </span><span class="kw">t.test</span>(<span class="kw">get</span>(col)<span class="op">~</span><span class="kw">get</span>(<span class="st">&quot;Insurance&quot;</span>),<span class="dt">data =</span> data)</span>
<span id="cb6-9"><a href="#cb6-9"></a>  tvalue =<span class="st"> </span>zz<span class="op">$</span>statistic[[<span class="dv">1</span>]]</span>
<span id="cb6-10"><a href="#cb6-10"></a>  pvalue =<span class="st"> </span>zz<span class="op">$</span>p.value</span>
<span id="cb6-11"><a href="#cb6-11"></a>  mean1 =<span class="st"> </span>zz<span class="op">$</span>estimate[[<span class="dv">1</span>]]</span>
<span id="cb6-12"><a href="#cb6-12"></a>  mean2 =<span class="st"> </span>zz<span class="op">$</span>estimate[[<span class="dv">2</span>]]</span>
<span id="cb6-13"><a href="#cb6-13"></a>  temp =<span class="st"> </span>ttest_table_before_match[,<span class="kw">list</span>(<span class="dt">varname =</span> col, <span class="dt">t.value =</span> tvalue,</span>
<span id="cb6-14"><a href="#cb6-14"></a>                           <span class="dt">p.value =</span> pvalue, <span class="dt">mean_no_insurance =</span> mean1,</span>
<span id="cb6-15"><a href="#cb6-15"></a>                           <span class="dt">mean_with_insurance =</span> mean2,</span>
<span id="cb6-16"><a href="#cb6-16"></a>                           <span class="dt">diff =</span> mean1 <span class="op">-</span><span class="st"> </span>mean2)]</span>
<span id="cb6-17"><a href="#cb6-17"></a>  ttest_table_before_match =<span class="st"> </span><span class="kw">rbind</span>(temp,ttest_table_before_match)</span>
<span id="cb6-18"><a href="#cb6-18"></a>}</span>
<span id="cb6-19"><a href="#cb6-19"></a></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="kw">kable</span>(ttest_table_before_match, <span class="dt">caption =</span> <span class="st">&quot;Compare the Mean of All Variables of Insured and Uninsured Procedures before Matching&quot;</span>)</span></code></pre></div>
<table>
<caption>Compare the Mean of All Variables of Insured and Uninsured Procedures before Matching</caption>
<thead>
<tr class="header">
<th align="left">varname</th>
<th align="right">t.value</th>
<th align="right">p.value</th>
<th align="right">mean_no_insurance</th>
<th align="right">mean_with_insurance</th>
<th align="right">diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">AvgSales</td>
<td align="right">-4.8758000</td>
<td align="right">0.0000013</td>
<td align="right">1.745647e+00</td>
<td align="right">3.5423991</td>
<td align="right">-1.7967519</td>
</tr>
<tr class="even">
<td align="left">GroupPurchase</td>
<td align="right">-2.6980109</td>
<td align="right">0.0070700</td>
<td align="right">9.210530e-02</td>
<td align="right">0.1397174</td>
<td align="right">-0.0476122</td>
</tr>
<tr class="odd">
<td align="left">Financing</td>
<td align="right">-3.9780773</td>
<td align="right">0.0000733</td>
<td align="right">6.856725e-01</td>
<td align="right">0.7817896</td>
<td align="right">-0.0961171</td>
</tr>
<tr class="even">
<td align="left">Ad</td>
<td align="right">-4.5169625</td>
<td align="right">0.0000069</td>
<td align="right">5.116960e-02</td>
<td align="right">0.1208791</td>
<td align="right">-0.0697095</td>
</tr>
<tr class="odd">
<td align="left">ReviewBonus</td>
<td align="right">0.5218571</td>
<td align="right">0.6018622</td>
<td align="right">2.924000e-03</td>
<td align="right">0.0015699</td>
<td align="right">0.0013541</td>
</tr>
<tr class="even">
<td align="left">SurgeonNum</td>
<td align="right">-9.3835064</td>
<td align="right">0.0000000</td>
<td align="right">9.722222e-01</td>
<td align="right">1.2558870</td>
<td align="right">-0.2836647</td>
</tr>
<tr class="odd">
<td align="left">Public</td>
<td align="right">-2.0704850</td>
<td align="right">0.0386169</td>
<td align="right">4.532160e-02</td>
<td align="right">0.0722135</td>
<td align="right">-0.0268919</td>
</tr>
<tr class="even">
<td align="left">PriceOrigin</td>
<td align="right">3.9876031</td>
<td align="right">0.0000705</td>
<td align="right">1.378258e+04</td>
<td align="right">9475.7959184</td>
<td align="right">4306.7888770</td>
</tr>
<tr class="odd">
<td align="left">PricePaid</td>
<td align="right">3.6664072</td>
<td align="right">0.0002562</td>
<td align="right">6.815352e+03</td>
<td align="right">4395.2276295</td>
<td align="right">2420.1247097</td>
</tr>
<tr class="even">
<td align="left">PriceDeposit</td>
<td align="right">2.6663212</td>
<td align="right">0.0077632</td>
<td align="right">9.464415e+02</td>
<td align="right">738.4175824</td>
<td align="right">208.0239381</td>
</tr>
<tr class="odd">
<td align="left">AvgReviews</td>
<td align="right">-1.5871114</td>
<td align="right">0.1127395</td>
<td align="right">3.936005e-01</td>
<td align="right">0.4587423</td>
<td align="right">-0.0651417</td>
</tr>
<tr class="even">
<td align="left">AvgCompNum</td>
<td align="right">-12.6088569</td>
<td align="right">0.0000000</td>
<td align="right">1.774866e+00</td>
<td align="right">4.5413598</td>
<td align="right">-2.7664936</td>
</tr>
<tr class="odd">
<td align="left">ProcedureAge</td>
<td align="right">-2.0790160</td>
<td align="right">0.0378100</td>
<td align="right">6.834795e+00</td>
<td align="right">7.3940345</td>
<td align="right">-0.5592392</td>
</tr>
</tbody>
</table>
<p>Notice, the p-value of most variables are smaller than .05, which means the characteristics of insured and uninsured procedures are mostly different. Next, let’s use <a href="https://cran.r-project.org/web/packages/MatchIt/MatchIt.pdf">MatchIt</a> package to perform propensity score matching. More details about this package please refer to the <a href="https://imai.fas.harvard.edu/research/files/matchit.pdf">JSS paper</a>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>psm =<span class="st"> </span><span class="kw">matchit</span>(Insurance <span class="op">~</span><span class="st">  </span>ProcedureAge <span class="op">+</span><span class="st"> </span>AvgCompNum <span class="op">+</span><span class="st"> </span>AvgReviews <span class="op">+</span><span class="st"> </span>PriceDeposit  <span class="op">+</span><span class="st"> </span>PricePaid <span class="op">+</span><span class="st"> </span>PriceOrigin <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>SurgeonNum <span class="op">+</span><span class="st"> </span>ReviewBonus <span class="op">+</span><span class="st"> </span>Ad <span class="op">+</span><span class="st"> </span>Financing <span class="op">+</span><span class="st"> </span>GroupPurchase ,</span>
<span id="cb7-2"><a href="#cb7-2"></a>              <span class="dt">data =</span> data, <span class="dt">method =</span> <span class="st">&quot;nearest&quot;</span>,</span>
<span id="cb7-3"><a href="#cb7-3"></a>              <span class="dt">ratio =</span> <span class="dv">1</span>, <span class="dt">distance =</span> <span class="st">&#39;logit&#39;</span>, <span class="dt">caliper =</span> <span class="fl">.05</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">## distance: This argument specifies the method used to estimate the distance measure. The default is logistic regression, &quot;logit&quot;. A variety of other methods are available.</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">## nearest: This means the matching method we use for PSM is nearest neighbor.</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">## ratio: the number of control units to match to each treated unit (default = 1).</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">## caliper: the number of standard deviations of the distance measure within which to draw control units (default = 0, no caliper matching). If a caliper is specified, a control unit within the caliper for a treated unit is randomly selected as the match for that treated unit. I</span></span></code></pre></div>
<p>The above command will generate a list of results. If we want to see the matching results, we can use:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>psm_result =<span class="st"> </span><span class="kw">summary</span>(psm)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">## The following shows the matching results.</span></span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="kw">kable</span>(<span class="kw">as.table</span>(psm_result<span class="op">$</span>nn), <span class="dt">caption =</span> <span class="st">&quot;Matching Results&quot;</span>)</span></code></pre></div>
<table>
<caption>Matching Results</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Control</th>
<th align="right">Treated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>All</td>
<td align="right">684</td>
<td align="right">637</td>
</tr>
<tr class="even">
<td>Matched</td>
<td align="right">438</td>
<td align="right">438</td>
</tr>
<tr class="odd">
<td>Unmatched</td>
<td align="right">246</td>
<td align="right">199</td>
</tr>
<tr class="even">
<td>Discarded</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The above table means: 438 procedures out of uninsured procedures are matched with 438 procedures out of insured procedures. Since we used one-to-one matching, the numbers of matched insured and uninsured procedures are the same. For the unmatched procedures, we can directly remove them. Then we can use the rest of sample for further analysis.</p>
<p>Here, we mainly focus on “weights”, which is a dummy variable and means whether the procedure has been selected during the matching process. If a procedure’s weight is 0, it means this procedure is in unmatched group.</p>
<p>To get the data after matching, we can run the following commands:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">## First combine weights to the original data set</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>data_psm =<span class="st"> </span><span class="kw">cbind</span>(data, <span class="dt">weights =</span> psm<span class="op">$</span>weights)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">## Next, let&#39;s remove all procedures that are removed by matching process</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>data_psm =<span class="st"> </span>data_psm[<span class="op">!</span>(weights <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)]</span></code></pre></div>
</div>
<div id="compare-the-mean-after-matching" class="section level3">
<h3>Compare the Mean after Matching</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">### Create blank data table</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>ttest_table_after_match =<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">varname =</span><span class="kw">character</span>(), <span class="dt">t.value=</span><span class="kw">numeric</span>(),</span>
<span id="cb10-3"><a href="#cb10-3"></a>                         <span class="dt">p.value =</span> <span class="kw">numeric</span>(), <span class="dt">mean_no_insurance =</span> <span class="kw">numeric</span>(),</span>
<span id="cb10-4"><a href="#cb10-4"></a>                         <span class="dt">mean_with_insurance =</span> <span class="kw">numeric</span>(), <span class="dt">diff =</span> <span class="kw">numeric</span>())</span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">### T-test for all variables</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="kw">colnames</span>(data_psm[,<span class="op">-</span><span class="kw">c</span>(<span class="st">&quot;ProcedureID&quot;</span>,<span class="st">&quot;weights&quot;</span>)])) {</span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="cf">if</span> (col <span class="op">==</span><span class="st"> &quot;Insurance&quot;</span>) <span class="cf">next</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>  zz =<span class="st"> </span><span class="kw">t.test</span>(<span class="kw">get</span>(col)<span class="op">~</span><span class="kw">get</span>(<span class="st">&quot;Insurance&quot;</span>),<span class="dt">data =</span> data_psm)</span>
<span id="cb10-9"><a href="#cb10-9"></a>  tvalue =<span class="st"> </span>zz<span class="op">$</span>statistic[[<span class="dv">1</span>]]</span>
<span id="cb10-10"><a href="#cb10-10"></a>  pvalue =<span class="st"> </span>zz<span class="op">$</span>p.value</span>
<span id="cb10-11"><a href="#cb10-11"></a>  mean1 =<span class="st"> </span>zz<span class="op">$</span>estimate[[<span class="dv">1</span>]]</span>
<span id="cb10-12"><a href="#cb10-12"></a>  mean2 =<span class="st"> </span>zz<span class="op">$</span>estimate[[<span class="dv">2</span>]]</span>
<span id="cb10-13"><a href="#cb10-13"></a>  temp =<span class="st"> </span>ttest_table_after_match[,<span class="kw">list</span>(<span class="dt">varname =</span> col, <span class="dt">t.value =</span> tvalue,</span>
<span id="cb10-14"><a href="#cb10-14"></a>                           <span class="dt">p.value =</span> pvalue, <span class="dt">mean_no_insurance =</span> mean1,</span>
<span id="cb10-15"><a href="#cb10-15"></a>                           <span class="dt">mean_with_insurance =</span> mean2,</span>
<span id="cb10-16"><a href="#cb10-16"></a>                           <span class="dt">diff =</span> mean1 <span class="op">-</span><span class="st"> </span>mean2)]</span>
<span id="cb10-17"><a href="#cb10-17"></a>  ttest_table_after_match =<span class="st"> </span><span class="kw">rbind</span>(temp,ttest_table_after_match)</span>
<span id="cb10-18"><a href="#cb10-18"></a>}</span>
<span id="cb10-19"><a href="#cb10-19"></a></span>
<span id="cb10-20"><a href="#cb10-20"></a><span class="kw">kable</span>(ttest_table_after_match, <span class="dt">caption =</span> <span class="st">&quot;Matching Results&quot;</span>)</span></code></pre></div>
<table>
<caption>Matching Results</caption>
<thead>
<tr class="header">
<th align="left">varname</th>
<th align="right">t.value</th>
<th align="right">p.value</th>
<th align="right">mean_no_insurance</th>
<th align="right">mean_with_insurance</th>
<th align="right">diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">AvgSales</td>
<td align="right">-1.8858742</td>
<td align="right">0.0597163</td>
<td align="right">1.832510e+00</td>
<td align="right">2.579934e+00</td>
<td align="right">-0.7474241</td>
</tr>
<tr class="even">
<td align="left">GroupPurchase</td>
<td align="right">0.3092044</td>
<td align="right">0.7572398</td>
<td align="right">1.255708e-01</td>
<td align="right">1.187215e-01</td>
<td align="right">0.0068493</td>
</tr>
<tr class="odd">
<td align="left">Financing</td>
<td align="right">0.1581048</td>
<td align="right">0.8744107</td>
<td align="right">7.625571e-01</td>
<td align="right">7.579909e-01</td>
<td align="right">0.0045662</td>
</tr>
<tr class="even">
<td align="left">Ad</td>
<td align="right">-0.6184344</td>
<td align="right">0.5364509</td>
<td align="right">7.534250e-02</td>
<td align="right">8.675800e-02</td>
<td align="right">-0.0114155</td>
</tr>
<tr class="odd">
<td align="left">ReviewBonus</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">2.283100e-03</td>
<td align="right">2.283100e-03</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">SurgeonNum</td>
<td align="right">0.2737771</td>
<td align="right">0.7843234</td>
<td align="right">1.173516e+00</td>
<td align="right">1.164384e+00</td>
<td align="right">0.0091324</td>
</tr>
<tr class="odd">
<td align="left">Public</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">6.392690e-02</td>
<td align="right">6.392690e-02</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">PriceOrigin</td>
<td align="right">0.5976922</td>
<td align="right">0.5502042</td>
<td align="right">1.171211e+04</td>
<td align="right">1.095673e+04</td>
<td align="right">755.3744292</td>
</tr>
<tr class="odd">
<td align="left">PricePaid</td>
<td align="right">0.1262775</td>
<td align="right">0.8995420</td>
<td align="right">5.433555e+03</td>
<td align="right">5.337893e+03</td>
<td align="right">95.6621005</td>
</tr>
<tr class="even">
<td align="left">PriceDeposit</td>
<td align="right">-0.0208389</td>
<td align="right">0.9833789</td>
<td align="right">8.719018e+02</td>
<td align="right">8.740251e+02</td>
<td align="right">-2.1232877</td>
</tr>
<tr class="odd">
<td align="left">AvgReviews</td>
<td align="right">-0.1465361</td>
<td align="right">0.8835329</td>
<td align="right">4.173479e-01</td>
<td align="right">4.253067e-01</td>
<td align="right">-0.0079588</td>
</tr>
<tr class="even">
<td align="left">AvgCompNum</td>
<td align="right">-0.7739172</td>
<td align="right">0.4391891</td>
<td align="right">2.280047e+00</td>
<td align="right">2.426153e+00</td>
<td align="right">-0.1461058</td>
</tr>
<tr class="odd">
<td align="left">ProcedureAge</td>
<td align="right">0.7950100</td>
<td align="right">0.4268242</td>
<td align="right">7.278539e+00</td>
<td align="right">7.011416e+00</td>
<td align="right">0.2671233</td>
</tr>
</tbody>
</table>
<p>Notice, the p-value of most variables are larger than .05, which means the characteristics of insured and uninsured procedures are now balanced. Now let’s use the new data for multiple regression.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">## Multiple linear regression</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>mlr_after_match =<span class="st"> </span><span class="kw">lm</span>(AvgSales<span class="op">~</span>Insurance <span class="op">+</span><span class="st"> </span>ProcedureAge <span class="op">+</span><span class="st"> </span>AvgCompNum <span class="op">+</span><span class="st"> </span>AvgReviews <span class="op">+</span><span class="st"> </span>PriceDeposit <span class="op">+</span><span class="st"> </span>PricePaid <span class="op">+</span><span class="st"> </span>PriceOrigin <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>SurgeonNum <span class="op">+</span><span class="st"> </span>ReviewBonus <span class="op">+</span><span class="st"> </span>Ad <span class="op">+</span><span class="st"> </span>Financing <span class="op">+</span><span class="st"> </span>GroupPurchase, <span class="dt">data =</span> data_psm) </span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">## Output the regression results</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="kw">summary</span>(mlr_after_match)</span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">#&gt; </span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">#&gt; Call:</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">#&gt; lm(formula = AvgSales ~ Insurance + ProcedureAge + AvgCompNum + </span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co">#&gt;     AvgReviews + PriceDeposit + PricePaid + PriceOrigin + Public + </span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">#&gt;     SurgeonNum + ReviewBonus + Ad + Financing + GroupPurchase, </span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">#&gt;     data = data_psm)</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">#&gt; </span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co">#&gt; -30.118  -1.861  -0.895   0.376  92.370 </span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="co">#&gt; </span></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="co">#&gt;                 Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="co">#&gt; (Intercept)   -5.814e-01  8.282e-01  -0.702   0.4829    </span></span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="co">#&gt; Insurance      7.150e-01  3.733e-01   1.915   0.0558 .  </span></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="co">#&gt; ProcedureAge  -5.485e-02  3.925e-02  -1.398   0.1626    </span></span>
<span id="cb11-21"><a href="#cb11-21"></a><span class="co">#&gt; AvgCompNum     7.556e-02  6.858e-02   1.102   0.2709    </span></span>
<span id="cb11-22"><a href="#cb11-22"></a><span class="co">#&gt; AvgReviews     2.183e+00  2.363e-01   9.237   &lt;2e-16 ***</span></span>
<span id="cb11-23"><a href="#cb11-23"></a><span class="co">#&gt; PriceDeposit  -5.483e-04  2.689e-04  -2.039   0.0418 *  </span></span>
<span id="cb11-24"><a href="#cb11-24"></a><span class="co">#&gt; PricePaid      4.029e-05  4.554e-05   0.885   0.3766    </span></span>
<span id="cb11-25"><a href="#cb11-25"></a><span class="co">#&gt; PriceOrigin   -1.638e-05  2.292e-05  -0.715   0.4749    </span></span>
<span id="cb11-26"><a href="#cb11-26"></a><span class="co">#&gt; Public         5.945e-01  8.902e-01   0.668   0.5044    </span></span>
<span id="cb11-27"><a href="#cb11-27"></a><span class="co">#&gt; SurgeonNum     8.983e-01  3.871e-01   2.321   0.0205 *  </span></span>
<span id="cb11-28"><a href="#cb11-28"></a><span class="co">#&gt; ReviewBonus   -3.626e-01  3.914e+00  -0.093   0.9262    </span></span>
<span id="cb11-29"><a href="#cb11-29"></a><span class="co">#&gt; Ad             4.346e-01  6.985e-01   0.622   0.5340    </span></span>
<span id="cb11-30"><a href="#cb11-30"></a><span class="co">#&gt; Financing      1.159e+00  5.098e-01   2.274   0.0232 *  </span></span>
<span id="cb11-31"><a href="#cb11-31"></a><span class="co">#&gt; GroupPurchase  1.376e+00  5.846e-01   2.353   0.0188 *  </span></span>
<span id="cb11-32"><a href="#cb11-32"></a><span class="co">#&gt; ---</span></span>
<span id="cb11-33"><a href="#cb11-33"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb11-34"><a href="#cb11-34"></a><span class="co">#&gt; </span></span>
<span id="cb11-35"><a href="#cb11-35"></a><span class="co">#&gt; Residual standard error: 5.515 on 862 degrees of freedom</span></span>
<span id="cb11-36"><a href="#cb11-36"></a><span class="co">#&gt; Multiple R-squared:  0.1315, Adjusted R-squared:  0.1184 </span></span>
<span id="cb11-37"><a href="#cb11-37"></a><span class="co">#&gt; F-statistic: 10.04 on 13 and 862 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>The effect of insurance with the matched data shows a significant result under .05 significant level.</p>
</div>
</div>
<div id="coarsened-exact-matching" class="section level2">
<h2>Coarsened Exact Matching</h2>
<p>Ideally, if there are exactly same two procedures, one is insured and the other is uninsured, comparing their average monthly sales will lead to a very precise estimate of the effect of insurance. However, it is almost impossible to find the exactly same two procedures. Let’s simply use price as the only characteristic of procedures. Although it is difficult to find two procedures with exactly the same price, we may be able to find one insured procedure whose price is $1,000 and the other uninsured procedure whose price is $1,010. Their prices. If we coarsen the exact number of price to some intervals, for example, we define price less than $500 as low price, $500 to $2,000 as medium price, above $2000 as high price. Then, it will be much easier to find matched sample from insured and uninsured procedures. This is the basic rationale of coarsened exact matching.</p>
<p>Coarsened exact matching allows us to coarsen each covariate automatically or mannually.</p>
<ul>
<li>Automatical Coarsening</li>
</ul>
<p>Without any priori knowledge, we can first try automatical coarsening. Several options are available such as “sturges”. How to choose the appropriate option depends on the distribution of the variables. For example, sturges rule works well for normally distributed variable. Therefore, it is important to check the distributions of all continuous variables before matching. In our case, ProcedureAge, AvgCompNum, AvgReviews, PriceDeposit, PricePaid, and PriceOrigin are continuous variables. SurgeonNum is a categorical variable including five categories. The following histogram shows that most variables are highly right-skewed.</p>
<ul>
<li>Manual Coarsening</li>
</ul>
<p>In practice, manual coarsening is more reasonable. For example, if the range of price is from 100 to 100,000, it will be meaningless to coarsen</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb12-2"><a href="#cb12-2"></a>ProcedureAgeHist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x=</span>ProcedureAge)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;ProcedureAge&quot;</span>)</span>
<span id="cb12-4"><a href="#cb12-4"></a></span>
<span id="cb12-5"><a href="#cb12-5"></a>AvgCompNumHist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x=</span>AvgCompNum)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;AvgCompNum&quot;</span>)</span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a>AvgReviewsHist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x=</span>AvgReviews)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;AvgReviews&quot;</span>)</span>
<span id="cb12-10"><a href="#cb12-10"></a></span>
<span id="cb12-11"><a href="#cb12-11"></a>PriceDepositHist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x=</span>PriceDeposit)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;PriceDeposit&quot;</span>)</span>
<span id="cb12-13"><a href="#cb12-13"></a></span>
<span id="cb12-14"><a href="#cb12-14"></a>PricePaidHist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data[PricePaid<span class="op">&lt;</span><span class="dv">150000</span>], <span class="kw">aes</span>(<span class="dt">x=</span>PricePaid)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;PricePaid&quot;</span>)</span>
<span id="cb12-16"><a href="#cb12-16"></a></span>
<span id="cb12-17"><a href="#cb12-17"></a>PriceOriginHist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x=</span>PriceOrigin)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;PriceOrigin&quot;</span>)</span>
<span id="cb12-19"><a href="#cb12-19"></a></span>
<span id="cb12-20"><a href="#cb12-20"></a>SurgeonNumHist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x=</span>SurgeonNum)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">color=</span><span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb12-21"><a href="#cb12-21"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;SurgeonNum&quot;</span>)</span>
<span id="cb12-22"><a href="#cb12-22"></a></span>
<span id="cb12-23"><a href="#cb12-23"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb12-24"><a href="#cb12-24"></a><span class="kw">grid.arrange</span>( ProcedureAgeHist, AvgCompNumHist,AvgReviewsHist,PriceDepositHist,PricePaidHist,PriceOriginHist,SurgeonNumHist, <span class="dt">ncol=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAwAAAAJACAMAAAANcPFkAAABPlBMVEUAAAAAADoAAGYAAIsAOpAAZmYAZrYzMzM6AAA6ADo6AGY6Ojo6OpA6kNtNTU1NTW5NTXlNTY5NaX9NbqtNjshTTWRZTVlZTY5eneRkTU1mAABmADpmAGZmZmZmkJBmtrZmtttmtv9pTY5uTU1uTW5uTY5ubo5ubqtunZ1uq8huq+R/aU2DTU2Djm6OTU2OTWmOTW6OTY6Obk2ObquOyMiOyP+O5P+QOgCQOjqQZgCQkDqQkGaQtpCQ27aQ29uQ2/+dnW6ijk2i//+rbk2rbm6rbo6rjk2rtX+ryKur5Mir5OSr5P+t2Oa2ZgC225C22/+2///Ijk3IyI7I///bkDrb/7bb/9vb///knV7kq27k///r6+v/tmb/yI7/zX//25D/27b/29v/5I7/5Kv//6L//7b//8j//9v//+T///+A4yxYAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAgAElEQVR4nO2dC3vkRlaG287gOMO6Z0PCzQO7GM8mYGBIsjReNgEDM1lCHC82bnZw0sZA44v+/x9AdVOr1KrS0b1U53ufZ6bbpZK6TqleVZXULc0SABgzG7sAAIwJBACsgQCANRAAsAYCOLmZz+cfXicPr+cffZ+YFxAZEMDJ1UL8//Rmkdx8bF5AbDQT4P0IqIrx6e25eHn4/DpZ/+xavzCKn8n+byhAkvxQmak6x5gbqWwA6ZhnPl8k60+/Tx4+O9cvid75P0yedgJU1y91abvFzVeGAFUrrV+di17g9iPZ8vVL+crb2w8/BQIoPAKsj8URsDAXzNaOXgDJ1WKrByhZObTGDQGqF1cLIHa3OApac8HN2lwEKJ8DVG0//BQIoHALcCua+9XCngtu1o5eADHoefr6+unNiToLdGIfAPzbDz8FAij8c4C0F7DngklhEvhenjHndLWpbgDp2O/FeVJ6HSBb2YrfW/OhpXQjgCt+/2d3t7hnAcRhz54LbtZW237vuw3FCph4D+Bj0wAc8YfW3HsTwLP/3Z/d3eJ+BXh4faLfZXPBzdolAhSOBhDAXwYI0H5xz2eBFuZtNhfcrF0iQKEyIIC/DBCg/eI+BdDt354LbtaGAAIIEK8A4vy/mP7ac8FsbQgggADxCuADAmggAASAAAwFMCeTrfjHPKtdGwhQvWE3ETWAZvGbN+gBmApg3nDtAcwbCAABIAAEgAAQAAJAAO8nhpYCARQNBTBTKacAY87vSECAFkAA9AAKCAABIAAEgAAQAAJAAAjg+cTQUiCAAgJ4ED+ErvhFGASAAPEKcDNflN8ZDgJoIEDMAqw/+WLhuDOcyQIBIEC5ANW/la4oIDlHbwI8vf32TdWd4aZ17SNPZfy534OU3RdKEbUA+sZYjjFwhQDV9UIoPylHbwLcnIhxj//OcJH3ACJqx32hFDELoG+M5RoDRy9Aesx/KusBrJXjFkAE7LovlCJmAfSNsVxj4OgFUEOAE85zAHHEq7gvVD7+MUd0taHNATaHPkoFOAQYM0w31NOg/jvDRS2A3N+u+0IpYu4BEnVjLNcYOPoeIGF/HeA2C7jkvlCKuAWQN8ZyjYE5COCEhwBXJ9m77ftCKaIWQN0YiO0cwAcLAdT013VfKEXMAugbY7nGwBBAELMAusN33BdKEbMA5kII2+sAHlgI4IGFAD4ggAYCQAAIAAEgAASAABCAkQDmctr0r4Q2i9+8gQBMBTBv0ANAAAgAASAABPhu6xFRVWWAAO0XjyaAGUnG/WW4ytrz/iLOBgL0sRg9QOONQIAWQAAIoIAAEAACMBTADCSnfxoYAjSBvQDmDXoACAABIAAEgAAxCHB/eCReVruX/s3GKkAh/lt5P5waP4mcugC19r8CAsQrgPj92+Z+MJT74kCAUqYiwHJm2PNvNYlTgLL4N78FpfwmdtoC1Nz/ipgEyI4AG+Qed9war5EAxW8LhCRASfzimN/wtjBjnuEjQYrfRaQCFLmVY2DHrfGaCVCor7AEKLI+fnFe59aI0+4B6hCrAHf7sgvUY8CrF9+kPYDr1ngxCmDHn5TfGMxaOS4BtuJ3EakAj6eF0Z9o8TVujecQINfvBjRKKGkAW/H7bg2piEqAkvgdRCpA6RzAdWu8CHsAO34dcY1bI05dAPZzgMfTskmwoOTWeBEKUIjfviEOg+sAW/vfSaQCbJ0BzgnAYg5AOANeWDkqAdrG78g8HQHuD2f2JEi0eNet8SIUYCt+J3EKUIjfPv/N785wyeY6QNmt8SIUgE6cAhSwzn8zfEKMDwigiVgA+/w3i7tD1xoCRCgAhkD5+O3z34yeEHP/8my7brZrL0IBFMT4FVEJoDDx2+e/OT0hZvXsnX+zcQtAjF8RoQBW/Nn5b05PiOnx69DTEIAQv+lIo/oyXEn8ta6EO7Y3OQEumPcAtPgVMfYAOn77/DeLJ8ToSdAOYQxsjiNRfReoRvzmTVQCFOKvfSV8e4uOz+5uMU6DNt4IToO2AAJAAAUEiEsA+bO4A/9G9dpRClAjfkVkArSL35F5QgIsxfz//rC6BiIVoE78irgEaBm/I/N0BOj/rhBhC9D2rghTF4D5XSEgAARgLkBPQ6A8QQuAIRDzIVBPk2BPGwlMADv+9bH4MhijX4RhEkwmVgHyiG++rF+dM7ozHB0uAsgvfziOgNELcCuaO6u7QtCJVYDH04P8vTHkjbFcR8AYBSjEX35foHjvDLcdv4tYBbgQsWc1oG6M5ToCxiiAHX8ivwHG6c5wxfidRPqDmK3TYPK+QM2OgAQBxgzfd2/MLP6H1yfJdvxW64lKAPanQUsFcB0BI+wBCvGvj8WvwhnNAdgLsHUeuLQH0GtHKIAdv2r/CaM7w+E6QLKyzwOvmc0BrPjFbXHEhQBO1wFWuA5gIVq86wgYpQBUYhWACicB2F4H8AEBNJEL4Fu7vQCFp8XUDoGeBQIMIoBjh0IAwvsmIdCzQIBBBHDEDwEgQGkZIED7xRCAlGUEAbZGAxDAAQSIUoCt2CCAAwhQqC97LhWoAOYLFZT4x/zChxsIoAhQACs9UAHMG/QATAUwx5GuBMgdmgb6whwEqEL/Is7xoHQFWwHQAygiFkD/Is71oHQFBIAAsQqgfxHnelC6AgJAgFgFEKS9QMMHpfc3du0ICECLtBwmAohvQLoelK5ADwAB4hVA/iJOUvKgdAUE6FmAbr4vBwGanQVamLclD0pXQICeBSjPQo7SkwMCVKDbv+tB6QoIELUAvt9DeAsbgwDmF3GOB6UrOAjguBDCQADvfZG8hY1BAB+sBHBcCIlfAP99kbyFhQDez64oWo3FAwjguhASvwBd3RdpzLPdbiCAolKAhhdCagqQ2zMDtSOqAA3vDLfVFtADOAhdANeFELY9gLUyBIheAEnJhZBuBXA9RGN8AdrPAVwXMyBA+8XDCdDzHICwmaaV4MhBFaDhneGq2wUE6GDxAAK4LoRwEaD9dYB8ch4I0H7xQNcByi6EDC6A82sR/QngpLEA+fcQoP3ioYZAJWsPLoCjeiEABGiyGAI0Cry4MgSo3kMQoJP3EKDbFAiggAAN409axz9lASovhHZ82bJ7IECjwIsrcxXAvEEP0KIB1HsfnwDj3j4RAiggQKP4TUfaVfzjDQGaxW/esBWg6wZQczPhN4CacaqtoQeouxg9QHUlOHJAgBZAAAiQdBq/q5wQAAJUVG8cAgz/jVEIoJi8AJRHjYUvgCM4CAABqqrX3TP46wECtAACjCyA6/czNeoBArQAAowsAKXtVNRDuAI4cMYSpADe3z1UFK3GYggQoQCOzThjCVKA3FsI0E0DoGSvUQ+TE6DGD4IgQPXi2gKM/oswSvYa9VC3AXTzk8iO4q+Irg8BmscfhwA93xmuo804jpIdCNDi1og9xE9hU/bS5OHirzhPPREBxr8rRN1VN2XvogG0uC3KSPHnKKuWceKvtrVIKAK47gw3ORp+GQ7xRxo/VQDHneF8VOcYcyM1G4Dj1oiu7Yef0m/89KVTGQI57gzX8NPpWUIRwHFrRNf2w0/pN3760qkI4JgDNPx0epZQBHCMgV3bDz+l3/jpS6cigOPOcA0/nZ4lFAEct0Z0bT/8lH7jpy+digCO6wANP52eJRQBHOfBXdsPP6Xf+OlLJyOAvXYENAoc8ccWfzMBkpaX0sPbSO8lmGIeKt18rWLwlSUQYKASTDEPFQgw/Y30XoIp5qHCUgAAYgACANZAAMAaCABYAwEAa5oJYF0WbEj+CXRNN3EsnuHdSWmaQ/n0m/l8/uG1NwulOmQe77YoNaLzEMpEolXttylEBw0oaSiA/fOgZtyKwNttSHw7cf3qvIvSNIf06VeLqs1QqkPm8W6LUiM6D6FMJNrVfotCdNCABI0EsL8a2IirF99snkLdcBu3IvLiI4yHhvLpT2/Pvctp1aHyeLdFqRGdp7pMNFrVfotCdNGABI0EsL8c3hBR7vYbStfupDSNoXx62k/LUYd3O4TqkE+ur9oWpUbShZQyUWhV+60K0U0DaiSA/fOghojyt96Q+JZuJ6VpDOXTxYij6mBHqQ65yyu2RakRkYdSJgqtar9VITppQBPvAR5en3RUmsaQP71iuEvtASq2RakRmYdSJgrta79pIUbsAToZda/bD+HWx4uuStMY8qcTBKjaVrUAlBpReShlotC+9tsIMNIcwP55UENEudttSO/JTkrTGMqni4766evq06BV2zKdvnNblBrReShlotCq9lsVon0DEkz5OoA4iSzmUJO4DvCiop+ucx3AuS1KjZg8hDKRaLsLGxdixOsAAMQCBACsgQCANRAAsAYCANZAAMAaCABYM5gAj6czwc4ZIe9q99K1aDk76LBQg+Iq+pJSLfeHe+LFUzOTobQedPMoWXT3AaXJNGZAAWRsS8oedO/mx9M/nmoTcBT98fTZO9Eojvxr3x/KHBEIUF4Punnc7VfUQ+cMLcD9ISFC925e7f568CrqCEfRL0T7Tw1QL07uD3/yo3dRCFBeD7p5JBd7AxdnBAHunv9ytnsp+ry9RPV95lXs3fRQt/Pl7qXs+NL/Npnlrr949pvTvUTl+ur5ZbbWBFBFV9WQ9oM6gvwBQVfF3Qdf7adjgbv0v6P0jy9ns1SONN/FgRQgq5l8tglRXg95AdRONTl+ncabS1mJaNNcIu4uAh9agIt0D+7LIPeyf6IRiFdxGLw/PEj/zu1mk1keI8VSMYgyubIF4WOKLkqb1oUVp8JUx91+mmUpWv1SVJaKUh44Li0B8tnGjKwejnrQzUM0b7NTdY401HzKxW8fpKlHqhY6GA0MPQlOQ5fFln35atMAVurofyRfl/ndfLRZKN+IFJMrWxA+pugisPRfFufzy3wOWSUiZPWfjj99FUEuD2wBctnGjKwejnowk+Dc3tY5TCZ1CHj8xZfP3qWvuXprx9A9QKL310octk1siToVIk4CyMO5CDDr6M82C3UHuZeYXEvXqYPwuMi6vQNzMMviVJgqMaFv/kj3vRDg/uWZNQTKZRszsno46kE2j7t9OerRO1XnSKPbpBzd/eg//uhS9gRq5NyaYATQ45hyAfTCdLyoepFMgEmMfgRZ0dPIf6P2rIzAdF+icVcJkCz3Ji+Aqx5U85AD/GynqhxCAJNysbfaezz9EzOd7GL6N5oA4sx3fgi0kxsKFXezWagGu2kHanKtSJcVQiAretrUv1KDeRWs3rlLHUwu9NxAR4uS9v9TF8BVD5spYra3dQ5xlDQpq2d/l44Ef+ulydDB4HcsAfKTYPUvbQhpoOKCj5gUicnR4+nOmc4sF/6DPAEksm+mTmqtoYJozGNW9HQni77bRJC7DpBNgm0BsklwIo6QhZqZmgDOesiuA2yags4hJ8E65f4w/W8lJv5SnC4CH0uApOw06M5ZdhpUnub66cuzTeadMzPpXwpPVC6zVujkiq76+SxOsZt1DNlpUGsI9OVMNRS5gYtCzUxNAGc9mOYhLhNnO1XmuNOnQWXKhT4VKJZ1s+cn/F2g1WQmAC4IEUyocTdnzD05TQFEd6h704lCjSB2AUbfk9MUQJ4qm3L7J0cQuwCj78mJCgBAN0AAwBoIAFgDAQBrIABgDQQArIEAgDUQALAGAgDWQADAGggAWAMBAGsgAGANBACsaSbA+xHQptbGLnsXIH5JQwHsP38oy1OWSM7Yw9qFxHYNgPBxgSf3Gz8lpeFqHW0IApRloQIBKjYPASBA4MkQQAEBmgABKjYPASBA4MkQQNFQgB807+X5YUp00wCs+Iu5wmjpjuR+449eAPPmve82FBoAix7AE38oLd2R3G/8EAAChNLSHckQQAEBmgABNBAAAkAACAABuAlgTiVY8Y95TqM2EKAsCxX2Apg36AEgAASAAPwEMB3p9IcAzeI3byAAUwHMG/QAEAACQAAIAAEgAASoKgMECCgZAiggQBMggAYCQAAIEKsAT2/mL86T5OH1/KPvsxd7bQgAAeIV4GqR3H70/dObRXLzcaJfCmtDAAgQrQAPn1+bl/XPrvVLYW0IAAGiFWD96a/EEGj96ffJw2fn+kWsKTDXE3ElFAJEK8DxQrT+dBQkWr5+KayNHiBeAW7mgoV8/fC65hwwCgGsQ/+mB8ivDQHiFUAgDnvpVDBJ6s4BYxDg4eeyyWMOUAITAcQR7+mtPOrV3P8xCCDUT4/7T29O1FmgE2ZngVoNAdylCCWZIoDY4WncohainQN6BEhDT3c86+sAjYcA7lKEkkyIXzb49SvZC9ScA0bRA3hgIkDzIYC7FKEkE+K/zY54V4uac0AIEIUAHIYAHq5OsncLjnMADzwEaDEEcJcilOTq+FXfJwJ/+vq65hwQAsQgQIshgLsUoSRXx6/DvZnnvxJWWBkCxCxAiyGAuxShJONKsAICOGkzBHCXIpRkCKCAAE7aDAHcpQglGQIoIEATIIAGAkAACAABIAAEgAAQgFSKUJIhgAICNAECaNgKYC6oR/1VAE/85g0EYCqAeYMeAAJAAAgAASAABIAAvg+EAK40CDBKcrv4zUxq+nNACNAE9gKYN+gBmApgjiPTPwI2i9+8gQBMBTBv0ANAAAgAASIR4P7wSLysdi+3P6N87bgE6Db+UFq6I7nf+CEABAilpTuSIYBiI8ByZtjb/gjH2jEJ0HX8obR0R3K/8U9RgOwIQCBGAbqOP5SW7kjuN/5pCkAnTgHoxCkAnVgFuNuXXSDXOUC38YfS0h3J/cY/TQEeTwujP3FDTEb3Bt2K30mcAnQY/zQF2BoD3swXCaNnhGEOwHwO8HhqV8D6ky8WnJ4RVozfTZwCdBj/NAUonAF+evvtmwWrZ4QRzoDbtReXAIX47QcjcLg14v3hLD8JujkR4x5GzwgrxO8hTgEK8VsPRmD4iCT5dJiSHiC/dlwCFGhzBHSXIpTkyvjtByMwvD26ekTQCaM5QIE2R0B3KUJJrozffjBCtENgzxBI7XxGzwiz4291BHSXIpTkyvjtByMwekTS/csz85bZdQCFiZ/JEdAZvyR7MAKnRyStnr3bTixfO0YBTPytjoDuUoSSXBm/JHswAqc5ANuvQ2vy8Tc9ArpLEUpyZfz2gxE4PSLpgnkPcNHBEdBdilCSq+O3H4zA6DrAzllSRZwC2PG3OgK6SxFKcmX8PiIVgE6cAhRocwR0lyKUZHwdWgEBmgABNLEJIH8Wd7D9CUViFaDL+ENp6Y7kfuOfqABLMf+/P6yugUgF6DT+UFq6I7nf+KcpAO4KgbtCJHzvCgEBIABzATAEwhCI9RAIk2BMgnlPgsnE/GUwUvzmTWQCUIEA5k1kPQAVCKCJTIDH0wPavTEiFaDT+ENp6Y7kfuOfqAAXInZKDZRXQJ5JCtAyflIpQkluF78ZSE5/CNzlaVC7MUxPgBrxm2qcfgNoFr95E1cPAAFwHSDhLEDb88BTFwDXAdhfB1i1Og88eQFaxk8qRSjJ/cY/VQGoxCoAlVgFoAIBzBsIAAEgAASAABAAAkAA3wdCgPJy1UmEAB0mQwAFBGgCBNBAAAgAAWIVYH0s7o1Z47YgEIBQilCSIYDCLYC4EeD61XmN24NDAEIpQkmGAAq3ALeiude6NSAEIJQilOTq+PUIwH5OSGHlmAUQbO4KS7k9eP79mF90JNFvA3DshYCSK+PXIwD7OSHFlSMXQNwQs8btwePqAVo1AHcpQkmujF+PAOznhBRXjluAh9cnSZ1nhMUlQKsG4C5FKMmkIWC6x+3nhCS+EcCYHXptSGeBxLGP9RyAQQPwIUYA9nNCipXn+UVg9S4JvAdQ7b/OM8KiE6BmAyCVIpRkQvxyBCDJnhNSXNmz/6uLELgA6imRC8bXAeo2AFIpQkmmnARYmLfZycDiyjEL4IOFALUbAKkUoSRXxq/Dt58TUlwZAsQrQP0GQCpFKMmV8ZsRgP2ckMLKECBeAeo3gOIkMIyW7kju4UIgBIhKAB+0BhBGS3ckQwAFBGgCBNBAAAgAASAABIAAEAACQAAIAAEgAAT4zj4l6C1XnUQI0GEyBFD0JUB5XUCAYJIhgAICNAECaCAABIAAHAUw3yqnCDDmt97dQIAWRPSTWPQATYioATSL37xh2wOYN1wFMG+49gDmDQSAABAAAkAACAABnAJ4fytdWlhHIgToMBkCKAYQwFsvpYV1JEKADpN7jn/roAcBIICvcLEJsLXPIQAvATzDPgjgLBUE8CZOSQBPzBDAWar4BSg7MkKAMZIhgGJgAfLvPRFBgN6TIYACAjSh1WlgCOAsFS8B6t5LdaoC5JOdhYtYAOd+5i5AsWGYTdaoMFpi6RYhQAu6mQNOS4Cat8arKUCeYoPxhU4ToGyLdRtAN/E7Sxy8AN3v/2kJUPcheYQKoLzfFMDVMQwkQEfxU/CF0l3yOPG76sJZzmAEqHt7bEIFUN47Ooaa5FctVkB48dfzguRRewF6jp+AJ5YhBHA9IWVyNPxBCOKPNH6qAI4npCgGOpE55lmg+vEHntxv/L2NXALoAfJru8sUmwD14w88ud/44xPAMQZ0lik2AerHH3hyv/HHJ4DjCSnOMsUmQP34A0/uN/74BHCcB3aWKTYB6scfeHK/8UcogL12BDQKHPHHFn8zAYr10XnGUTdZm3pbDid3V1A+lVSyQTekgAAdEE6ThgA1MkkgQAeE06QhQI1Mkk4EAGCqQADAGggAWAMBAGsgAGBNewGsS4TbrI/n80WWy34pIn51Qcj59Gb+4py0yfTDP7wmfnhTqjZ3O3eXYXtdX2zbuX3xdRymk/LPuZnLsL0lk98t8uVIX37nT68rNzZ3t7DqumgtgP1Toe3q+ew8Wb8617nsl5JaWySEnFcL8e1cQkbx4TeknM2p2pzYy1sf7i6KJ7bt3A+vF874Og7TieNz0jg2C8tLdisatS9H+nI7//F1xcb+5rN//NjVwgh10VoA+2uCW9x+LGtD57JfinnXn3yxSKpzirTNB/s2Kb/D+/k16cObQtnc1oc7i+KLbTu3/o4yMXc/lH/O09vzqjiuXnyTrubL8fD5P734l9/954qN/fvHYmPlLYxQF60FsL8oXl5Hn53rXPbLVqV9m5panXP96a/EMIGwSd0DUD68MZTNpUef0jJsr+uLrSy3O1vHYTop/xw5MHHszGwN0SarQvjf3/tbwsb+1V8JvrpoLYD9U6EyxDdpdS77pZDv5kR0VdU518eyMiibVGM/Ss7GVG9ufZw26dIybK/ri207txwCvSjP1nGYTso/Jx2TiAO3v2RCAF8O8SIEqNzYX/+Fo4UR6qL/HuDh9YnjWLW1oSdiD0CVXNTc7YfXo/cA9CNTzeNYOgn+87ch9gCSq0U3PUDVxv7vD/+geW/Y9xxAHtNIA3Yx1Z/PTwhzgJ/LcAib1OaPPgdwTYJK5gCe2Mo/yTXHGXcOIKmKel05B7hO/iudA1RsbH38+9f+6UavcwD7p0JbqPZvctkvJdtaUHJeLVR3UZlR9wC0D29I1ea0hKVlKFnXE9t2bjnHcWTrOEwn5Z8jon76urzmszVEm/TlEC//+ePrio392fFffZw4WhihLvq+DqCO64tOrwOkacSz+7dz6hWD5lRt7sZThu11fbFt507ja3Luu1Oc1wEqo65zHcC9sb/0tbABrgMAMGUgAGANBACsgQCANRAAsAYCANZAAMCaYQV4PJ0Jds7Un3cfnDly7BE2Jtb+73/ruIRDQa6Jnc0Ck2m1ezlMIfuhOvSUlchyZP7K5SnP3pyhBTgQL0v3HlQ5Hk+fvaNsr+vaGA5qTZTlmLwAVaEnyYVYeH9IawWtGEWA+8Oj5jnyTF6ARjURhwC+XbxULV/n7JWxBLh7/svZ7q/T9is6xL1EdYzpjjUxL/eypLsPvpzNRI2YrHf7snu8++Cr9E3/VdQL5JoQ7UQGfCB1vz+c7XwZiwDu0LUbqepZHhH5V88v00pQO550hKxmFAHSDu5uf08ewB9P9+Q+Fq9CfCPASrxVSXf7u5fivfknD/t3+0eyKibeA1TXRJpDHivTEUOa6f7wIM0UhQCe0LPdKnaxzmMil0np4dA7gqrBKJNgcVjfP1Lx5Sd2aSVkAuxemiSTVf4tjwkq9IkLUF0TJsf/iPGAyiEXdrXvR6I69Gy3Fvf+Ugtw1N3od5QeINHlN3GlLGWlzA5yPYBJklnTqliJYZD440KPhKYtALUmBCt51iTNJAfH5ggwUapD3wjw8szkMZGbvR6dAHrCb3Jc7GVJWwKIv2a7l7EKUKgJEe3OmdY9cgGy0HNzgMgFyHo/fVo4N/UzSarHe34p/zZ1pTrKmARw1EQie0OZnBsGDl/g7qgO3QzyRE5LktVudAJsZrfpXk4rIHcdwCQVJ8GyKlQ9EM+WBgi1JgSiXdzt76iA92KZBCfu0PPXAUye/CQ4JgGsM2A7Z2aGdJBskuRpUJNFvKoRsZ4OUK4ZBwilJrI5QDrp2fl7NTeM5zRo4g49yV0JzvLoyKctQCOmO84BHbPq/tIwBACTYCU7xe77ewgApsGS+B3JmkxAAAD6AwIA1kAAwBoIAFgDAQBrIABgDQQArIEAgDUQALAGAgDWQADAGggAWAMBAGsgAGBNMwHej4COKxJMk4YC2H/+UJanLJGcsf+1IQAQQADAGggAWAMBAGsgAGBN/wK8l8eXsTIRAoDOGUCA7zZAABAYEACwpqEAP9CxBKixXs9AACBADwBYAwEAayAAYA0EAKyBAIA1EACwBgIA1kAAwBoIAFgDAQBrIABgDQQArIEAgDVuAW7mgoV8/fA6eXg9/+h7swwCgEjw9wC3aZu/Woh3T29SFT426RAARIJXgIfPzpOnt+fy7efXyfpn13oBBACR4BVAHPLToY8YCK0//V76oO8KV+OXJ/hBDAgYnwCywa9fyV5ADIaUAAL0ACASfALcZrPeq8WmBxBAABAJPgGuTuwjdkMAAAYRSURBVLJ3C8wBQJR4BFDTX9ENPH19/fTmBGeBQHx4BNAjnpv5/MV5gusAIEpwJRiwBgIA1kAAwBoIAFgDAQBrIABgDQQArIEAgDUQALAGAgDWQADAGggAWINHJAHWoAcArIEAgDUQALAGAgDWQADAGggAWJMX4P7wSLysdi+r1oIAIBIgAGDNRoDlzLBXuRYEAJFQ0gMQgAAgEjAJBqyxBLjbl0MgzAEAG/ICPJ5Wj/4VEABEAuYAgDV2D2AJYD8cDPcGBTFizQHsKwDWw8HwjDAQJfYQaJabBNsPB8PzAUCUuE+D2g8HwzPCQJS4BbAfDoZnhIEocQ+BJNnDwfCMMBAl2z3A/cuzzR/Zw8EwBwBRUjIEWj17J17sh4PhGWEgSsoE0EMg++FguA4AYqREgAvVA/iAACASSibBO2fO3AYIACIBX4cGrIEAgDW2APJnkQfVa0EAEAmWAEtx/uf+sNoACAAiAXeFAKyBAIA1GAIB1mASDFiD06CANXhEEmCNJcDj6QHt3ijoAUAkWAJciLZPMQACgEjAaVDAGggAWIPrAIA19lmgFa4DAF7gOgBgDQQArIEAgDUQALAGAgDWQADAGggAWBOeAO/loX9MZSIEACV4BFgfi+cDFJ6UpOhVAGd+CAA6x/OAjM/O5TMCrCclaSAAiAS3ALeiuV8t7Ccl6WUQAESCfw6Q9gL2k5KS/h+RNNAvyCAAEHgFEA8FsJ+UpBegBwCR4BPg4fWJfpc9KUn/DQFAJHjPAi3M2+xJSfpvCAAiwfOUSNX+7SclaSAAiAS3AOL8v5j+2k9KUkAAEAkBXgmGAGA4IABgDQQArIEAgDUQALAGAgDWQADAGggAWAMBAGtaCuD+/SIEAFOgrQDu1g0BwASAAIA1LZ8RRvj5Fn4RBgIGPQBgDQQArIEAgDUQALAGAgDWQADAGggAWAMBAGsgAGANBACsgQCANRAAsAYCANZAAMAasgDl9waFAGDaUAVwPCMMAoBpQxXA8XyAcQTw/BK5bJOl2SEAEFAFcDwj7L3JgV+EgTxUAZo/I6xRxv7XhgBAUL8HEEAAEAkt5wAKCACmCv0sUNNnhDXKCAHAMLS8DqCAAGCqNLwSHAEdVySYJs0EKEBuTPRW1/0m0eJBCRAAsAYCANZ0IgAAUwUCANZAAMAaCABYAwEAa9oLYF0i9rP5MlFFvuP5fEHJeDuff0jbpPxFDwBFWgtg/1TMyy2xtYpvna5fnVdnFEIRPzu5oSkFmNFaAPtroj6uXnxD6wFuRZu+IrZXYq+y/uQLCAC2aS2A/UOBirzEIVCSkDdJ7AGe3n6LIRAoobUA9k/F/NAFEN++Jm3x+AXpo29OMAcAZYTZAzy8prX/hNhVpIWEAKCMAecAdc4C1WislMnCzVxAlgrwoYOzQCfkMzHUCSu1/dcZfqEHAGWEeB1AHa8p7TXNSZsDQABQDq4EA9ZAAMAaCABYAwEAayAAYA0EAKyBAIA1AwuwnM1mO2c1V7o/3BMvq93LHkoEeDOsAEvRhlezo3pr3R/KNSAA6J5BBXg8lU3/4tm7WqvdH/7kR+8gAOiDgQU40O/uPjiT/909/+Vs9zI9xO989fwyXT6biVYuXvfE8q/2Z+nB//7w6OJACpCtJpcc3MnFADRn2CHQKm218k3Wkvf3xBH+IP23e/l4mv6xfPZOvIp/d/tpV7EUfhzdpXrkBZBLZmrxoBGAyBj6LJCYBe/lBTjSY5u0JcvXtLXLV9HcxcI0U5qULA9sAcQSvXjgCEBUjHAa9P7w2bvNWOZMHvTTP55fCjlSDlbyb71QC3D/8swaAp1tJBo+AhAPY1wHyLVgWwA9OS4TIFnuQQDQPYMKoFtrUQAz5FnpKwTyNdfcpQCPv/gSAoDOGbYHuBBNW8xvxbz38XRHteTNJDg99KetP5sE5wVIJ9BiOpxbDQKA9oxwJVieCBJnMH/6UrVkcaVrJz2+y9OfShFrpqwESC7SHPnVIABoTzDfBVrVvDoGQBeEIIAY88trAAAMTQgCmIsDAAxOEAIAMBYQALAGAgDWQADAGggAWAMBAGsgAGDN/wMd+IIQPSMUmQAAAABJRU5ErkJggg==" /><!-- --></p>
<p>Notice, there is no sense to coarsen dummy variables (i.e., binary variables) since they are already “coarsened” into two categories. We use 0.5 as the cut point to keep these dummy variables unchanged. You can also use any number strictly between 0 and 1 as the cut point.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>PriceDepositCut =<span class="st"> </span><span class="kw">c</span>(<span class="fl">99.5</span>,<span class="fl">999.5</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a>PricePaidCut =<span class="st"> </span><span class="kw">c</span>(<span class="fl">999.5</span>,<span class="fl">4999.5</span>,<span class="fl">9999.5</span>)</span>
<span id="cb13-3"><a href="#cb13-3"></a>PriceOriginCut =<span class="st"> </span><span class="kw">c</span>(<span class="fl">999.5</span>,<span class="fl">4999.5</span>,<span class="fl">9999.5</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a>ProcedureAgeCut =<span class="st"> </span><span class="dv">2</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>AvgCompNumCut =<span class="st"> </span><span class="dv">2</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>SurgeonNumCut =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="fl">1.5</span>)</span>
<span id="cb13-7"><a href="#cb13-7"></a>AvgReviewsCut =<span class="st"> </span><span class="dv">2</span></span>
<span id="cb13-8"><a href="#cb13-8"></a></span>
<span id="cb13-9"><a href="#cb13-9"></a>cut_man =<span class="st"> </span><span class="kw">list</span>(<span class="dt">ProcedureAge =</span> ProcedureAgeCut, <span class="dt">AvgCompNum =</span> AvgCompNumCut, <span class="dt">AvgReviews =</span> AvgReviewsCut, <span class="dt">PriceDeposit =</span> PriceDepositCut, <span class="dt">PricePaid =</span> PricePaidCut, <span class="dt">PriceOrigin =</span> PriceOriginCut,  <span class="dt">SurgeonNum =</span> SurgeonNumCut,<span class="dt">Public =</span> <span class="kw">c</span>(<span class="fl">0.5</span>), <span class="dt">ReviewBonus =</span> <span class="kw">c</span>(<span class="fl">0.5</span>),<span class="dt">Ad =</span> <span class="kw">c</span>(<span class="fl">0.5</span>),<span class="dt">Financing =</span> <span class="kw">c</span>(<span class="fl">0.5</span>),<span class="dt">GroupPurchase =</span> <span class="kw">c</span>(<span class="fl">0.5</span>))</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">### Imbalance before matching</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="kw">imbalance</span>(data<span class="op">$</span>Insurance, data, <span class="dt">drop=</span><span class="kw">c</span>(<span class="st">&quot;ProcedureID&quot;</span>,<span class="st">&quot;AvgSales&quot;</span>, <span class="st">&quot;Insurance&quot;</span>), <span class="dt">breaks =</span> cut_man)</span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="co">#&gt; </span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">#&gt; Multivariate Imbalance Measure: L1=0.377</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co">#&gt; Percentage of local common support: LCS=50.8%</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co">#&gt; </span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co">#&gt; Univariate Imbalance Measures:</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co">#&gt; </span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co">#&gt;                   statistic   type          L1  min           25%</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co">#&gt; ProcedureAge  -5.592392e-01 (diff) 0.000000000    0  0.000000e+00</span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="co">#&gt; AvgCompNum    -2.766494e+00 (diff) 0.000000000    0 -7.500000e-01</span></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="co">#&gt; AvgReviews    -6.514174e-02 (diff) 0.000000000    0 -9.090909e-02</span></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="co">#&gt; PriceDeposit   2.080239e+02 (diff) 0.000000000  -19 -5.600000e+01</span></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co">#&gt; PricePaid      2.420125e+03 (diff) 0.000000000  -89 -3.810000e+02</span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="co">#&gt; PriceOrigin    4.306789e+03 (diff) 0.000000000 -581 -1.700000e+03</span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="co">#&gt; Public        -2.689186e-02 (diff) 0.026891863    0  0.000000e+00</span></span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="co">#&gt; SurgeonNum    -2.836647e-01 (diff) 0.093587907    0  0.000000e+00</span></span>
<span id="cb14-18"><a href="#cb14-18"></a><span class="co">#&gt; ReviewBonus    1.354118e-03 (diff) 0.001354118    0  0.000000e+00</span></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="co">#&gt; Ad            -6.970953e-02 (diff) 0.069709530    0  0.000000e+00</span></span>
<span id="cb14-20"><a href="#cb14-20"></a><span class="co">#&gt; Financing     -9.611712e-02 (diff) 0.096117124    0 -1.000000e+00</span></span>
<span id="cb14-21"><a href="#cb14-21"></a><span class="co">#&gt; GroupPurchase -4.761216e-02 (diff) 0.047612162    0  0.000000e+00</span></span>
<span id="cb14-22"><a href="#cb14-22"></a><span class="co">#&gt;                         50%         75%   max</span></span>
<span id="cb14-23"><a href="#cb14-23"></a><span class="co">#&gt; ProcedureAge     0.00000000    0.000000     3</span></span>
<span id="cb14-24"><a href="#cb14-24"></a><span class="co">#&gt; AvgCompNum      -1.50000000   -4.333333    -9</span></span>
<span id="cb14-25"><a href="#cb14-25"></a><span class="co">#&gt; AvgReviews      -0.07352941    0.000000    -5</span></span>
<span id="cb14-26"><a href="#cb14-26"></a><span class="co">#&gt; PriceDeposit   -63.00000000  438.000000     0</span></span>
<span id="cb14-27"><a href="#cb14-27"></a><span class="co">#&gt; PricePaid     -420.00000000 3200.000000 82000</span></span>
<span id="cb14-28"><a href="#cb14-28"></a><span class="co">#&gt; PriceOrigin      0.00000000 7000.000000 18999</span></span>
<span id="cb14-29"><a href="#cb14-29"></a><span class="co">#&gt; Public           0.00000000    0.000000     0</span></span>
<span id="cb14-30"><a href="#cb14-30"></a><span class="co">#&gt; SurgeonNum       0.00000000   -1.000000    -2</span></span>
<span id="cb14-31"><a href="#cb14-31"></a><span class="co">#&gt; ReviewBonus      0.00000000    0.000000     0</span></span>
<span id="cb14-32"><a href="#cb14-32"></a><span class="co">#&gt; Ad               0.00000000    0.000000     0</span></span>
<span id="cb14-33"><a href="#cb14-33"></a><span class="co">#&gt; Financing        0.00000000    0.000000     0</span></span>
<span id="cb14-34"><a href="#cb14-34"></a><span class="co">#&gt; GroupPurchase    0.00000000    0.000000     0</span></span>
<span id="cb14-35"><a href="#cb14-35"></a></span>
<span id="cb14-36"><a href="#cb14-36"></a><span class="co">### CEM matching</span></span>
<span id="cb14-37"><a href="#cb14-37"></a>cem_man &lt;-<span class="st"> </span><span class="kw">cem</span>(<span class="dt">treatment =</span> <span class="st">&quot;Insurance&quot;</span>, <span class="dt">data =</span> data, <span class="dt">keep.all=</span><span class="ot">TRUE</span>, <span class="dt">eval.imbalance =</span> <span class="ot">TRUE</span>, <span class="dt">drop =</span> <span class="kw">c</span>(<span class="st">&quot;ProcedureID&quot;</span>,<span class="st">&quot;Insurance&quot;</span>,  <span class="st">&quot;AvgSales&quot;</span>),<span class="dt">cutpoints =</span> cut_man, <span class="dt">L1.breaks =</span> cut_man )</span></code></pre></div>
</div>
<div id="notes" class="section level2">
<h2>Notes</h2>
<ul>
<li><p>The above t-test is not strict enough since variables are not normally distributed and may also be not independent since two procedures from the same hospital could be correlated. One can use some non-parametric methods when assumptions do not hold such as Wilcoxon signed-rank test.</p></li>
<li><p>CEM dominates PSM and we recommend using CEM instead of PSM. The reason has been explained above: PSM tries to mimic random experiment whose expectation of bias is 0 but CEM tries mimic an experiment with exactly same paired subjects (which is called fully blocked randomized experiment) whose bias is designed to be 0. However, CEM needs us to have some priori knowledge about the covariates to coarsen them.</p></li>
<li><p>All the matching methods are based on observable covariates that exist in our dataset. If the assignment depends on unobservable confounders, there could still be bias after matching. Matching can help us reduce the unbalance between the treatment and control groups only based on observable characteristics.</p></li>
</ul>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
